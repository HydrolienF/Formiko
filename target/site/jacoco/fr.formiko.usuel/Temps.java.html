<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Temps.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Formiko</a> &gt; <a href="index.source.html" class="el_package">fr.formiko.usuel</a> &gt; <span class="el_source">Temps.java</span></div><h1>Temps.java</h1><pre class="source lang-java linenums">package fr.formiko.usuel;

import fr.formiko.formiko.Main;
import fr.formiko.usuel.ecrireUnFichier;
import fr.formiko.usuel.lireUnFichier;
import fr.formiko.usuel.listes.GString;
import fr.formiko.usuel.types.str;

import java.text.SimpleDateFormat;
import java.util.Date;

/**
 *{@summary Time information about game.}&lt;br&gt;
 *It contain date of 1a launch. Date of last launch and time played.
 *@author Hydrolien
 *@version 1.4
 */
public class Temps {
  /***
   *{@summary Date of 1a lauch.}&lt;br&gt;
   *@version 1.4
   */
  private long date1;
  /***
   *{@summary Date of last lauch.}&lt;br&gt;
   *@version 1.4
   */
  private long date2;
  /***
   *{@summary Time played.}&lt;br&gt;
   *@version 1.4
   */
  private long tempsEnJeux;
  /***
   *{@summary DateFormat.}&lt;br&gt;
   *@version 1.4
   */
<span class="fc" id="L38">  private String df = &quot;dd/MM/yyyy HH:mm&quot;;</span>


  // CONSTRUCTEUR ---------------------------------------------------------------
<span class="fc" id="L42">  public Temps(){chargerTemps();}</span>
  // GET SET --------------------------------------------------------------------
<span class="nc" id="L44">  public long getDate1(){ return date1;}</span>
<span class="nc" id="L45">  public void setDate1(long x){date1=x;}</span>
<span class="nc" id="L46">  public long getDate2(){ return date2;}</span>
<span class="nc" id="L47">  public void setDate2(long x){date2=x;}</span>
<span class="nc" id="L48">  public void actualiserDate2(){date2=System.currentTimeMillis();}</span>
<span class="nc" id="L49">  public long getTempsEnJeux(){ return tempsEnJeux;}</span>
<span class="nc" id="L50">  public void setTempsEnJeux(long x){tempsEnJeux=x;}</span>
<span class="nc" id="L51">  public void addTempsEnJeux(long x){ setTempsEnJeux(getTempsEnJeux()+x);}</span>
<span class="nc" id="L52">  public String getDf(){return df;}</span>
<span class="nc" id="L53">  public void setDf(String s){df=s;}</span>
  // Fonctions propre -----------------------------------------------------------
  public String toString(){
<span class="nc" id="L56">    String r=&quot;&quot;;</span>
<span class="nc" id="L57">    SimpleDateFormat sdf = new SimpleDateFormat(df);</span>
<span class="nc" id="L58">    r+=g.getM(&quot;date1&quot;) + &quot; : &quot;;</span>
<span class="nc" id="L59">    Date date1b = new Date(date1);</span>
<span class="nc" id="L60">    r+=sdf.format(date1b);r+=&quot;\n&quot;;</span>
<span class="nc" id="L61">    r+=g.getM(&quot;date2&quot;) + &quot; : &quot;;</span>
<span class="nc" id="L62">    Date date2b = new Date(date2);</span>
<span class="nc" id="L63">    r+=sdf.format(date2b);r+=&quot;\n&quot;;</span>
<span class="nc" id="L64">    r+=g.getM(&quot;tempsEnJeux&quot;) + &quot; : &quot;;</span>
<span class="nc" id="L65">    r+=msToTime(tempsEnJeux);r+=&quot;\n&quot;;</span>
    /*En français ca donne :
    Date de 1ère connection : 02/09/2020 19:41
    Date de dernière connection : 02/09/2020 20:19
    Temps en jeux total : 3 min 46 s
    */
<span class="nc" id="L71">    return r;</span>
  }
  /**
  *{@summary Load all time informations save in Temps.txt.}
  *@version 1.23
  */
  public void chargerTemps(){
    //lecture du fichier Temps.txt
<span class="fc" id="L79">    String t [] = lireUnFichier.lireUnFichier(Main.getFolder().getFolderTemporary()+&quot;Temps.txt&quot;);</span>
<span class="fc bfc" id="L80" title="All 2 branches covered.">    if(t.length&lt;3){</span>
<span class="fc" id="L81">      initialiserFichierTemps();</span>
<span class="fc" id="L82">      t = lireUnFichier.lireUnFichier(Main.getFolder().getFolderTemporary()+&quot;Temps.txt&quot;);</span>
    } //normalement a ce stade la initialiserFichierTemps a déja réparer le fichier temps mais au cas ou on vérifi que tout est bon.
<span class="pc bpc" id="L84" title="1 of 2 branches missed.">    if(t.length&gt;=3){</span>
<span class="fc" id="L85">      date1 = str.sToL(t[0]);</span>
<span class="fc" id="L86">      date2 = str.sToL(t[1]);</span>
<span class="fc" id="L87">      tempsEnJeux = str.sToL(t[2]);</span>
    }else{
<span class="nc" id="L89">      erreur.erreur(&quot;Le fichier Temps.txt est corrompu.&quot;,&quot;les variables de temps ont été remises à 0.&quot;);</span>
<span class="nc" id="L90">      initialiserFichierTemps();</span>
<span class="nc" id="L91">      date1 = System.currentTimeMillis();</span>
<span class="nc" id="L92">      date2 = System.currentTimeMillis();</span>
<span class="nc" id="L93">      tempsEnJeux = 0;</span>
    }
<span class="fc" id="L95">  }</span>
  public void sauvegarder(){
<span class="nc" id="L97">    GString gs = new GString();</span>
<span class="nc" id="L98">    gs.add(&quot;&quot;+date1);</span>
<span class="nc" id="L99">    gs.add(&quot;&quot;+date2);</span>
<span class="nc" id="L100">    gs.add(&quot;&quot;+tempsEnJeux);</span>
<span class="nc" id="L101">    ecrireUnFichier.ecrireUnFichier(gs,Main.getFolder().getFolderTemporary()+&quot;Temps.txt&quot;);</span>
<span class="nc" id="L102">  }</span>
  //static ---------------------------------------------------------------------------
  //TODO add une méthode qui return un String de date le plus adapté possible avec un nombre défini d'unité allant de jours a ms.
  //par défaut on a 2 unité. ex : x jours y heures  ex2 : x min y s
  /**
  *{@summary return time with as specify number of unit.}
  *@param ms times in ms.
  *@param nbrOfUnit number of units to include in the return string.
  *@param dayOn enable or disable day as a unit.
  *@version 1.23
  */
  public static String msToTime(long ms, int nbrOfUnit, boolean dayOn){
<span class="fc bfc" id="L114" title="All 2 branches covered.">    if(nbrOfUnit&lt;1){return &quot;&quot;;}</span>
<span class="fc" id="L115">    String ts [] = {&quot;t.j&quot;,&quot;t.h&quot;,&quot;t.min&quot;,&quot;t.s&quot;,&quot;t.ms&quot;};</span>
<span class="fc" id="L116">    long tl [] = msToTimeLongArray(ms,dayOn);</span>
<span class="fc" id="L117">    int k=0; int i=0;</span>
<span class="fc" id="L118">    String r = &quot;&quot;;</span>
<span class="fc bfc" id="L119" title="All 4 branches covered.">    while(k&lt;nbrOfUnit &amp;&amp; i&lt;5){</span>
<span class="fc bfc" id="L120" title="All 2 branches covered.">      if(tl[i]&gt;0){</span>
<span class="fc bfc" id="L121" title="All 2 branches covered.">        if(!r.equals(&quot;&quot;)){r+=&quot; &quot;;}</span>
<span class="fc bfc" id="L122" title="All 6 branches covered.">        if(i==3 &amp;&amp; k+1 &lt; nbrOfUnit &amp;&amp; tl[i+1]&gt;0){ //si on doit traiter les s et les ms ensembles.</span>
<span class="fc" id="L123">          String s = &quot;&quot;+tl[i+1];</span>
<span class="fc bfc" id="L124" title="All 2 branches covered.">          while(s.length()&lt;3){</span>
<span class="fc" id="L125">            s=&quot;0&quot;+s;</span>
          }
<span class="fc bfc" id="L127" title="All 4 branches covered.">          while(s.length() &gt; 1 &amp;&amp; s.charAt(s.length()-1)=='0'){</span>
<span class="fc" id="L128">            s=s.substring(0,s.length()-1);</span>
          }
<span class="fc" id="L130">          r+= tl[i]+g.get(&quot;t.,&quot;)+s+g.get(ts[i]);</span>
<span class="fc" id="L131">          k++;i++;</span>
<span class="fc" id="L132">        }else{</span>
<span class="fc" id="L133">          r+= tl[i]+g.get(ts[i]);</span>
        }
<span class="fc" id="L135">        k++;</span>
      }
<span class="fc" id="L137">      i++;//pour ne pas sortir du tableau.</span>
    }
<span class="fc bfc" id="L139" title="All 2 branches covered.">    if(r.equals(&quot;&quot;)){</span>
<span class="fc" id="L140">      r = tl[4]+g.get(ts[4]);</span>
    }
<span class="fc" id="L142">    return r;</span>
  }
<span class="fc" id="L144">  public static String msToTime(long ms){return msToTime(ms,2,true);}</span>
  /**
  *{@summary return time on a long [].}
  *@param ms times in ms.
  *@param dayOn enable or disable day as a unit.
  *@version 1.23
  */
  public static long [] msToTimeLongArray(long ms, boolean dayOn){
<span class="fc" id="L152">    long tr [] = new long[5];</span>
<span class="fc bfc" id="L153" title="All 2 branches covered.">    if(ms&lt;0){</span>
<span class="fc" id="L154">      tr[4]=-1;</span>
<span class="fc" id="L155">      return tr;</span>
    }
<span class="fc" id="L157">    int nbrMsD = 86400000; int nbrMsH = 3600000; int nbrMsM = 60000; int nbrMsS = 1000;</span>
    long d,h,m,s;
<span class="fc bfc" id="L159" title="All 2 branches covered.">    if(dayOn){</span>
<span class="fc" id="L160">      d = ms / nbrMsD;</span>
<span class="fc" id="L161">      h = (ms % nbrMsD) / nbrMsH;</span>
    }else{
<span class="fc" id="L163">      d=0;</span>
<span class="fc" id="L164">      h = ms / nbrMsH;</span>
    }
<span class="fc" id="L166">    m = (ms % nbrMsH) / nbrMsM;</span>
<span class="fc" id="L167">    s = (ms % nbrMsM) / nbrMsS;</span>
<span class="fc" id="L168">    ms = ms % nbrMsS;</span>
<span class="fc" id="L169">    tr[0]=d;tr[1]=h;tr[2]=m;tr[3]=s;tr[4]=ms;</span>
<span class="fc" id="L170">    return tr;</span>
  }
  /**
  *{@summary return current date + current hours.}
  *@version 1.23
  */
  public static String getDatePourSauvegarde(){
<span class="nc" id="L177">    String df2 = &quot;dd-MM-yyyy HH-mm-ss&quot;;</span>
<span class="nc" id="L178">    SimpleDateFormat sdf = new SimpleDateFormat(df2);</span>
<span class="nc" id="L179">    return sdf.format(System.currentTimeMillis());</span>
  }
  /**
  *{@summary Initialize time file.}
  *@version 1.23
  */
  public static void initialiserFichierTemps(){
<span class="fc" id="L186">    GString gs = new GString();</span>
<span class="fc" id="L187">    gs.add(&quot;&quot;+System.currentTimeMillis());</span>
<span class="fc" id="L188">    gs.add(&quot;&quot;+System.currentTimeMillis());</span>
<span class="fc" id="L189">    gs.add(&quot;0&quot;);</span>
<span class="fc" id="L190">    ecrireUnFichier.ecrireUnFichier(gs,Main.getFolder().getFolderTemporary()+&quot;Temps.txt&quot;);</span>
<span class="fc" id="L191">  }</span>
  /**
  *{@summary Try to stop execution of the programme during some ms.}
  *@param ms number of ms to wait before continue.
  *@version 1.23
  */
  public static void pause(int ms){
<span class="nc bnc" id="L198" title="All 2 branches missed.">    if(ms&lt;1){erreur.erreurPause(ms);}</span>
    try {
<span class="nc" id="L200">        Thread.sleep(ms);</span>
<span class="nc" id="L201">    } catch (InterruptedException ie) {</span>
<span class="nc" id="L202">        erreur.erreurPause(ms);</span>
<span class="nc" id="L203">    }</span>
<span class="nc" id="L204">  }</span>
<span class="nc" id="L205">  public static String msToS(int x){return msToS((long)x);}</span>
  /**
  *{@summary Transform ms to s.}
  *@version 1.23
  */
  public static String msToS(long x){
<span class="nc" id="L211">    String sr = x/1000+g.get(&quot;,&quot;)+x%1000+&quot;s&quot;;</span>
<span class="nc" id="L212">    return sr;</span>
  }
  public static String msToHMS(long ms){
<span class="nc" id="L215">    long tempsS = ms/1000;</span>
    //long h = (long) (tempsS / 3600);
    //long m = (long) ((tempsS % 3600) / 60);
    //long s = (long) (tempsS % 60);
<span class="nc" id="L219">    long h = tempsS / 3600;</span>
<span class="nc" id="L220">    long m = (tempsS % 3600) / 60;</span>
<span class="nc" id="L221">    long s = tempsS % 60;</span>
<span class="nc" id="L222">    String r=&quot;&quot;;</span>
<span class="nc bnc" id="L223" title="All 2 branches missed.">    if(h&gt;0) {r+=h+&quot; &quot;+g.get(&quot;t.h&quot;)+&quot; &quot;;}</span>
<span class="nc bnc" id="L224" title="All 2 branches missed.">    if(m&gt;0) {r+=m+&quot; &quot;+g.get(&quot;t.min&quot;)+&quot; &quot;;}</span>
<span class="nc bnc" id="L225" title="All 2 branches missed.">    if(s&gt;0) {r+=s+&quot; &quot;+g.get(&quot;t.s&quot;);}</span>
<span class="nc bnc" id="L226" title="All 6 branches missed.">    if(h&lt;=0 &amp;&amp; m&lt;=0 &amp;&amp; s&lt;=0) {r=&quot;0 &quot;+g.get(&quot;t.s&quot;);}</span>
<span class="nc" id="L227">    return r;</span>
  }
  /**
  *{@summary Print current date.}
  *@version 1.23
  */
  public static void affDateDuJour(String format){
<span class="nc" id="L234">    SimpleDateFormat sdf = new SimpleDateFormat(format);</span>
<span class="nc" id="L235">    Date date2b = new Date(System.currentTimeMillis());</span>
<span class="nc" id="L236">    System.out.println(sdf.format(date2b));</span>
<span class="nc" id="L237">  }</span>
<span class="nc" id="L238">  public static void affDateDuJour(){affDateDuJour(&quot;dd/MM/yyyy&quot;);}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>