<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>chargerLesTraductions.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Formiko</a> &gt; <a href="index.source.html" class="el_package">fr.formiko.usuel</a> &gt; <span class="el_source">chargerLesTraductions.java</span></div><h1>chargerLesTraductions.java</h1><pre class="source lang-java linenums">package fr.formiko.usuel;

import fr.formiko.formiko.Main;
import fr.formiko.usuel.lireUnFichier;
import fr.formiko.usuel.listes.GString;
import fr.formiko.usuel.tableau;
import fr.formiko.usuel.types.str;

import java.io.File;
import java.util.HashMap;

/**
*{@summary Loard translation file class.}&lt;br&gt;
*@author Hydrolien
*@version 1.5
*/
<span class="nc" id="L17">public class chargerLesTraductions {</span>
  private static HashMap&lt;String, String&gt; map;
<span class="fc" id="L19">  private static String rep=Main.getFolder().getFolderStable()+Main.getFolder().getFolderLanguages();</span>
<span class="fc" id="L20">  private static String tLangue[]=null;</span>
<span class="fc" id="L21">  private static int defaultLanguage=2;</span>
  // get set -------------------------------------------------------------------
<span class="fc" id="L23">  public static String [] getTLangue(){return tLangue;}</span>
<span class="fc" id="L24">  public static void setTLangue(String t []){tLangue=t;}</span>
<span class="fc" id="L25">  public static String getRep(){return rep;}</span>
<span class="fc" id="L26">  public static void setRep(String s){rep = str.sToDirectoryName(s);}</span>
<span class="fc" id="L27">  public static void setRep(){setRep(Main.getFolder().getFolderStable()+Main.getFolder().getFolderLanguages());}</span>
<span class="fc" id="L28">  public static HashMap&lt;String, String&gt; getMap(){return map;}</span>
<span class="fc" id="L29">  public static void iniMap(){map = new HashMap&lt;&gt;();}</span>
  // Fonctions propre -----------------------------------------------------------
  /**
  *{@summary get the int that corresponds to the language String.}&lt;br&gt;
  *@param x language id.
  *@return language String in ISO code 639-1 if tLangue is correct.
  *@version 1.5
  */
  public static String getLanguage(int x){
<span class="fc bfc" id="L38" title="All 6 branches covered.">    if(tLangue == null || x&lt;0 || x&gt;=tLangue.length){</span>
<span class="fc" id="L39">      int l = 0;</span>
<span class="fc bfc" id="L40" title="All 2 branches covered.">      if(tLangue!=null){l=tLangue.length;}</span>
<span class="fc" id="L41">      erreur.erreur(&quot;langue non reconnu parmi les &quot;+l+&quot; langue(s) disponible(s).&quot;,&quot;\&quot;en\&quot; retourné&quot;);</span>
<span class="fc" id="L42">      return &quot;en&quot;;</span>
    }
<span class="fc" id="L44">    return tLangue[x];</span>
  }
  /**
  *{@summary get the String that corresponds to the language int.}&lt;br&gt;
  *An error will return 2, the id of &quot;en&quot; (english) (except if tLangue isn't correctly loard (return -1;))
  *@param s language String in ISO code 639-1.
  *@version 1.37
  */
  public static int getLanguage(String s){
<span class="pc bpc" id="L53" title="1 of 2 branches missed.">    if(tLangue == null){ return -1;}</span>
<span class="fc bfc" id="L54" title="All 4 branches covered.">    if (s==null || s.equals(&quot;&quot;)) { return getDefautlLanguage();}</span>
<span class="fc" id="L55">    int k=0;</span>
<span class="fc bfc" id="L56" title="All 2 branches covered.">    for (String s2 : tLangue) {</span>
<span class="fc bfc" id="L57" title="All 2 branches covered.">      if(s2.equals(s)){return k;}</span>
<span class="fc" id="L58">      k++;</span>
    }
<span class="fc" id="L60">    return getDefautlLanguage();</span>
  }
  /**
  *Return defaultLanguage if it is aviable or -1.
  *@version 1.37
  */
  public static int getDefautlLanguage(){
<span class="fc bfc" id="L67" title="All 2 branches covered.">    if(tLangue.length&lt;defaultLanguage+1){return -1;}</span>
<span class="fc" id="L68">    return defaultLanguage;</span>
  }
  /**
  *{@summary Loard language file &quot;langue.csv&quot;.}&lt;br&gt;
  *If it fail only &quot;en&quot; will be aviable.
  *@version 1.5
  */
  public static boolean iniTLangue(){
    try {
<span class="fc" id="L77">      String t []=lireUnFichier.lireUnFichier(rep+&quot;langue.csv&quot;);</span>
<span class="pc bpc" id="L78" title="1 of 2 branches missed.">      if(t==null){throw new NullPointerException();}//on passe dans le catch.</span>
<span class="fc bfc" id="L79" title="All 2 branches covered.">      if(t.length==0){throw new Exception();}//TODO find a better Exception</span>
<span class="fc" id="L80">      tLangue=new String[t.length];int k=0;</span>
<span class="fc bfc" id="L81" title="All 2 branches covered.">      for (String s : t ) {</span>
<span class="fc" id="L82">        String s2 = s.split(&quot;,&quot;)[0];</span>
<span class="fc" id="L83">        tLangue[k]=s2;k++;</span>
      }
<span class="fc" id="L85">      return true;</span>
<span class="fc" id="L86">    }catch (Exception e) {</span>
<span class="fc" id="L87">      erreur.erreur(&quot;Impossible de charger tLangue.&quot;);</span>
<span class="fc" id="L88">      tLangue=new String [1]; tLangue[0]=&quot;en&quot;;</span>
<span class="fc" id="L89">      return false;</span>
    }
  }
  /**
  *{@summary Check that every language file exists and create is if it's need.}&lt;br&gt;
  *@version 1.5
  */
  public static boolean créerLesFichiers(){
<span class="fc bfc" id="L97" title="All 2 branches covered.">    for (String s :tLangue ) {</span>
<span class="fc" id="L98">      File f = new File(rep+str.sToFileName(s)+&quot;.txt&quot;);</span>
      try {
<span class="fc" id="L100">        f.createNewFile();</span>
<span class="nc" id="L101">      }catch (Exception e) {</span>
<span class="nc" id="L102">        erreur.erreur(&quot;Impossible de créer un fichier de trad&quot;);</span>
<span class="nc" id="L103">        return false;</span>
<span class="fc" id="L104">      }</span>
    }
<span class="fc" id="L106">    return true;</span>
  }
  /**
  *{@summary Check that the line is a translation line.}&lt;br&gt;
  *@param s line to check
  *@version 1.5
  */
  public static boolean estLigneDeTrad(String s){
<span class="fc bfc" id="L114" title="All 2 branches covered.">    if(s==null){return false;}</span>
<span class="fc bfc" id="L115" title="All 2 branches covered.">    if(s.length()&lt;2){return false;}//minimum = &quot;c:&quot;</span>
    //if(s.charAt(0)=='/' &amp;&amp; s.charAt(1)=='/'){return false;}
<span class="fc bfc" id="L117" title="All 2 branches covered.">    if(str.contient(s,&quot;//&quot;,0)){return false;}</span>
<span class="fc bfc" id="L118" title="All 2 branches covered.">    if(str.contient(s,&quot;:&quot;,0)){return false;}</span>
<span class="fc bfc" id="L119" title="All 2 branches covered.">    if(str.nbrDeX(s,':')==0){return false;}//si il y a un nombre différent de fois &quot;:&quot; que 1 fois.</span>
    //return s.length()&gt;2 &amp;&amp; (s.charAt(0)!='\\' || s.charAt(1)!='\\');// si la ligne n'est pas vide ou pas un commentaire.
<span class="fc" id="L121">    return true;</span>
  }



  /**
  *{@summary get an array of translation for a given language.}&lt;br&gt;
  *@param langue id if the language
  *@version 1.7
  */
  public static String [] getTableauDesTrad(int langue){
    //String tDéfaut [] = lireUnFichier.lireUnFichier(rep+&quot;fr.txt&quot;);
<span class="fc" id="L133">    String t [] = new String[0];</span>
    try{
<span class="fc" id="L135">      debug.débogage(&quot;chargement de la langue &quot;+getLanguage(langue));</span>
<span class="fc" id="L136">      t=lireUnFichier.lireUnFichier(rep+getLanguage(langue)+&quot;.txt&quot;);</span>
<span class="nc" id="L137">    }catch (Exception e) {</span>
<span class="nc" id="L138">      erreur.erreur(&quot;Echec du chargement de la langue spécifiée&quot;,&quot;en choisi par défaut&quot;);</span>
<span class="nc" id="L139">      t=lireUnFichier.lireUnFichier(rep+&quot;en.txt&quot;);</span>
<span class="fc" id="L140">    }</span>
<span class="fc" id="L141">    return t;</span>
  }
  /**
  *{@summary Load translation for nation name.}&lt;br&gt;
  *@version 1.26
  */
  public static String []getTableauDesNationsName(){
<span class="nc" id="L148">    String t [] = new String[0];</span>
    try{
<span class="nc" id="L150">      t=lireUnFichier.lireUnFichier(&quot;docs/cc/&quot;+&quot;nationsName&quot;+&quot;.csv&quot;);</span>
<span class="nc" id="L151">    }catch (Exception e) {</span>
<span class="nc" id="L152">      erreur.erreur(&quot;Echec du chargement de nationsName&quot;);</span>
<span class="nc" id="L153">    }</span>
<span class="nc" id="L154">    return t;</span>
  }
  /**
  *{@summary get an array of command.}&lt;br&gt;
  *@version 1.7
  */
  public static String [] getTableauDesCmd(){
<span class="fc" id="L161">    String t [] = new String[0];</span>
    try{
<span class="fc" id="L163">      debug.débogage(&quot;chargement des commandes&quot;);</span>
<span class="fc" id="L164">      t=lireUnFichier.lireUnFichier(rep+&quot;cmd&quot;+&quot;.txt&quot;);</span>
<span class="nc" id="L165">    }catch (Exception e) {</span>
<span class="nc" id="L166">      erreur.erreur(&quot;Echec du chargement des commandes&quot;);</span>
<span class="fc" id="L167">    }</span>
<span class="fc" id="L168">    return t;</span>
  }
  /**
  *{@summary Load translation for a given language.}&lt;br&gt;
  *It included command.
  *@param langue id if the language
  *@version 1.7
  */
  public static HashMap&lt;String, String&gt; chargerLesTraductions(int langue){
<span class="fc" id="L177">    debug.débogage(&quot;Chargement des textes&quot;);//on lit le fichier de langue</span>
<span class="fc" id="L178">    map = chargerLesTraductionsSansCommande(langue);</span>
<span class="fc" id="L179">    String t2[] = getTableauDesCmd();</span>
<span class="fc bfc" id="L180" title="All 2 branches covered.">    for (String s : t2) {//on ajoute toutes les commande qu'on peu add.</span>
<span class="fc" id="L181">      addObjetMap(s);</span>
    }
<span class="fc" id="L183">    return map;</span>
  }
  /**
  *{@summary Load translation for a given language.}&lt;br&gt;
  *It don't included command.
  *@param langue id if the language
  *@version 1.7
  */
  public static HashMap&lt;String, String&gt; chargerLesTraductionsSansCommande(int langue){
<span class="fc" id="L192">    iniMap();</span>
<span class="fc" id="L193">    String t[] = getTableauDesTrad(langue);</span>
<span class="fc bfc" id="L194" title="All 2 branches covered.">    for (String s : t) {//on ajoute toutes les lignes qu'on peu add.</span>
<span class="fc" id="L195">      addObjetMap(s);</span>
    }
<span class="fc" id="L197">    return map;</span>
  }
  /**
  *{@summary Load translation for nation name.}&lt;br&gt;
  *@version 1.26
  */
  public static HashMap&lt;String, String&gt; chargerLesNationsName(){
<span class="nc" id="L204">    iniMap();</span>
<span class="nc" id="L205">    String t[] = getTableauDesNationsName();</span>
<span class="nc bnc" id="L206" title="All 2 branches missed.">    for (String s : t) {//on ajoute toutes les lignes qu'on peu add.</span>
<span class="nc" id="L207">      addObjetMap(s);</span>
    }
<span class="nc" id="L209">    return map;</span>
  }
  /**
  *{@summary Add a translated line on the actual map.}&lt;br&gt;
  *@param s Translated line.
  *@version 1.7
  */
  public static void addObjetMap(String s){
<span class="fc bfc" id="L217" title="All 2 branches covered.">    if(!estLigneDeTrad(s)){return;}</span>
    //getPosDu1a &quot;:&quot;
    //coupe en 2.
<span class="fc" id="L220">    int lens = s.length();</span>
<span class="fc" id="L221">    debug.débogage(&quot;Ligne non vide et non commentaire idendifiée&quot;);</span>
<span class="fc" id="L222">    String s1 = &quot;&quot;;</span>
<span class="fc" id="L223">    String s2 = &quot;&quot;;</span>
<span class="fc" id="L224">    int i=0;</span>
<span class="fc" id="L225">    debug.débogage(&quot;élément de &quot;+lens+&quot;identifié&quot;);</span>
<span class="fc" id="L226">    char c = s.charAt(i);</span>
<span class="pc bpc" id="L227" title="1 of 4 branches missed.">    while(c != ':' &amp;&amp; i&lt;lens-1){</span>
<span class="pc bpc" id="L228" title="1 of 2 branches missed.">      if(c!='\\'){s1 = s1+c;}</span>
<span class="fc" id="L229">      i++; c = s.charAt(i);</span>
    }
    //lower char as 1a char
<span class="fc bfc" id="L232" title="All 2 branches covered.">    if(i&lt;lens-1){</span>
<span class="fc" id="L233">      i++; c = s.charAt(i);</span>
<span class="fc" id="L234">      s2 = s2+(c+&quot;&quot;).toLowerCase();</span>
    }
<span class="fc bfc" id="L236" title="All 2 branches covered.">    while(i&lt;lens-1){</span>
<span class="fc" id="L237">      i++; c = s.charAt(i);</span>
<span class="fc" id="L238">      s2 = s2+c;</span>
    }
<span class="fc" id="L240">    debug.débogage(&quot;Ajout du couple clé valeur  &quot;+s1+&quot; : &quot;+s2);</span>
<span class="fc" id="L241">    map.put(s1,s2);</span>
<span class="fc" id="L242">  }</span>
  /**
  *{@summary Add auto translation for every languages.}&lt;br&gt;
  *Please refert to ThTrad to have more informations
  *@version 1.7
  */
  public static void addTradAuto(){
<span class="nc bnc" id="L249" title="All 2 branches missed.">    if(tLangue==null){iniTLangue();}</span>
<span class="nc" id="L250">    int lentl=getTLangue().length;</span>
<span class="nc" id="L251">    new ThTrad(0);</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">    for (int i=2;i&lt;lentl ;i++ ) {</span>
<span class="nc" id="L253">      new ThTrad(i);</span>
    }
<span class="nc" id="L255">  }</span>
  /**
  *{@summary Count the %age translated.}&lt;br&gt;
  *It don't included command (that are not translate).
  *@param langue id if the language
  *@version 1.7
  */
  public static int getPourcentageTraduit(int langue){
<span class="fc" id="L263">    int x = 0;</span>
<span class="fc" id="L264">    String [] t= new String [0];</span>
    try {
<span class="fc" id="L266">      t=lireUnFichier.lireUnFichier(rep+getLanguage(langue)+&quot;.txt&quot;);</span>
<span class="pc" id="L267">    }catch (Exception e) {}</span>
<span class="fc bfc" id="L268" title="All 2 branches covered.">      for (String s : t ) {</span>
<span class="fc bfc" id="L269" title="All 2 branches covered.">        if(estLigneDeTrad(s)){</span>
<span class="fc bfc" id="L270" title="All 2 branches covered.">          if(fini(s)){ x++;}</span>
        }
      }
<span class="fc" id="L273">    int xFr = chargerLesTraductionsSansCommande(1).size();</span>
<span class="fc bfc" id="L274" title="All 2 branches covered.">    if (xFr==0){return -1;}</span>
<span class="fc" id="L275">    return (x*100)/xFr;</span>
  }
  /**
  *{@summary Count the %age translated automatically.}&lt;br&gt;
  *It don't included command (that are not translate).
  *@param langue id if the language
  *@version 1.7
  */
  public static int getPourcentageTraduitAutomatiquement(int langue){
<span class="fc" id="L284">    int x = 0;</span>
<span class="fc" id="L285">    String [] t= new String [0];</span>
    try {
<span class="fc" id="L287">      t=lireUnFichier.lireUnFichier(rep+getLanguage(langue)+&quot;.txt&quot;);</span>
<span class="pc" id="L288">    }catch (Exception e) {}</span>
<span class="fc bfc" id="L289" title="All 2 branches covered.">      for (String s : t ) {</span>
<span class="fc bfc" id="L290" title="All 4 branches covered.">        if(s.length()&gt;6 &amp;&amp; s.substring(s.length()-6).equals(&quot;[auto]&quot;)){</span>
<span class="fc" id="L291">          x++;</span>
        }
      }
<span class="fc" id="L294">    int xFr = chargerLesTraductionsSansCommande(1).size();</span>
<span class="fc" id="L295">    return (x*100)/xFr;</span>
  }
  /**
  *{@summary Print getPourcentageTraduitAutomatiquement and getPourcentageTraduit data for every languages.}&lt;br&gt;
  *@version 1.7
  */
  public static void affPourcentageTraduit(){
<span class="nc bnc" id="L302" title="All 2 branches missed.">    if(tLangue==null){iniTLangue();}</span>
<span class="nc" id="L303">    int lentl=getTLangue().length;</span>
<span class="nc bnc" id="L304" title="All 2 branches missed.">    for (int i=0;i&lt;lentl ;i++) {</span>
<span class="nc bnc" id="L305" title="All 2 branches missed.">      String s = &quot;&quot;;int x=getPourcentageTraduitAutomatiquement(i); if(x&gt;0){s=&quot; (&quot;+x+&quot;% traduit automatiquement)&quot;;}</span>
<span class="nc" id="L306">      int y = getPourcentageTraduit(i);</span>
<span class="nc bnc" id="L307" title="All 2 branches missed.">      if(x&gt;0){</span>
<span class="nc" id="L308">        System.out.println(getLanguage(i)+&quot; : &quot;+y+&quot;%&quot;+s);</span>
      }
    }
<span class="nc" id="L311">  }</span>
<span class="fc bfc" id="L312" title="All 2 branches covered.">  public static boolean fini(String s){return !str.contient(s,&quot;:&quot;,2);}</span>
  /**
  *{@summary Add untranslated key to the actual Map.}&lt;br&gt;
  *For all key in english map, if key isn't in g.getMap() we add it.
  *@version 1.33
  */
  public static void completMapWithFullTranslatedLanguage(){
<span class="fc" id="L319">    HashMap&lt;String,String&gt; hm = chargerLesTraductions(getLanguage(&quot;en&quot;));</span>
<span class="fc bfc" id="L320" title="All 2 branches covered.">    for (String key : hm.keySet() ) {</span>
<span class="fc bfc" id="L321" title="All 2 branches covered.">      if(!g.exist(key)){</span>
<span class="fc" id="L322">        g.getMap().put(key,hm.get(key));</span>
      }
<span class="fc" id="L324">    }</span>
<span class="fc" id="L325">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>