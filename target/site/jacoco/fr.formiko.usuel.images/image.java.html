<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>image.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Formiko</a> &gt; <a href="index.source.html" class="el_package">fr.formiko.usuel.images</a> &gt; <span class="el_source">image.java</span></div><h1>image.java</h1><pre class="source lang-java linenums">package fr.formiko.usuel.images;

import fr.formiko.formiko.Main;
import fr.formiko.usuel.debug;
import fr.formiko.usuel.erreur;
import fr.formiko.usuel.fichier;
import fr.formiko.usuel.g;
import fr.formiko.usuel.maths.math;
import fr.formiko.usuel.types.str;

import java.awt.Graphics2D;
import java.awt.Image;
import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;
import javax.imageio.ImageIO;

/**
 *{@summary image class that contain a lot of tools to use images. }&lt;br&gt;
 *@author Hydrolien
 *@version 1.4
 */
<span class="nc" id="L23">public class image{</span>
  /***
   *{@summary The Images directory.}&lt;br&gt;
   *@version 1.33
   */
<span class="fc" id="L28">  private static final String REP_STABLE = Main.getFolder().getFolderStable()+Main.getFolder().getFolderImages();</span>
  /***
   *{@summary The Images directory. Used to put temporary Images.}&lt;br&gt;
   *@version 1.33
   */
<span class="fc" id="L33">  private static final String REP_TEMPORARY = Main.getFolder().getFolderTemporary()+Main.getFolder().getFolderImages();</span>
  /***
   *{@summary The Images directory for extra texture.}&lt;br&gt;
   *You can add new image that will be used as the game texture (as chargement(Max+1)).
   *Or You can replace some images by puting an image with the same name than an actual image in REP_STABLE or REP_TEMPORARY.
   *@version 1.33
   */
<span class="fc" id="L40">  private static String REP_TEXTUREPACK = Main.getFolder().getFolderResourcesPacks()+Main.getFolder().getFolderImages();</span>
  // GET SET --------------------------------------------------------------------
<span class="fc" id="L42">  public static String getREPTEXTUREPACK(){return REP_TEXTUREPACK;}</span>
  public static void setREPTEXTUREPACK(String s){
<span class="fc bfc" id="L44" title="All 2 branches covered.">    if(s!=null){s = str.sToDirectoryName(s);}</span>
<span class="fc" id="L45">    REP_TEXTUREPACK=s;</span>
<span class="fc" id="L46">  }</span>
<span class="nc" id="L47">  public static String getREP(){ return REP_STABLE;}</span>
  // Fonctions propre -----------------------------------------------------------
  /**
   *{@summary Try to read an Image file}&lt;br&gt;
   *Image are File who end with &quot;.png&quot; or &quot;.jpg&quot;.&lt;br&gt;
   *@param f File that sould contain the Image.
   *@return Image on the file or null if something went wrong.
   *@version 1.3
   */
  public static BufferedImage readImage(File f){
<span class="fc bfc" id="L57" title="All 2 branches covered.">    if(!isImage(f)){erreur.erreur(&quot;L'Image sencé être dans le fichier suivant n'as pas été reconnue en temps qu'image. &quot;+f.toString());return null;}</span>
    try {
<span class="fc" id="L59">      return ImageIO.read(f);</span>
<span class="fc" id="L60">    }catch (IOException e) {</span>
      //on n'affiche plus systématiquement l'erreur car on a parfois besoin d'essayer d'ouvrir une image et de ressevoir null pour réésayer dans un autre répertoire.
      //erreur.erreur(&quot;L'Image sencé être dans le fichier suivant n'as pas été correctement trouvé et chargée. &quot;+f.toString());
<span class="fc" id="L63">      return null;</span>
    }
<span class="nc" id="L65">  }public static BufferedImage readImage(String s){return readImage(new File(s));}</span>
  /**
   *{@summary get an Image in 1 of the 3 usuals images directories.}&lt;br&gt;
   *It will 1a search on REP_TEXTUREPACK, then in REP_STABLE and finaly in REP_TEMPORARY.
   *Image are File who end with &quot;.png&quot; or &quot;.jpg&quot;.&lt;br&gt;
   *.png or .jpg do not need to be precised on the name.&lt;br&gt;
   *@param nom Name of the file without REP_STABLE part.
   *@param returnImageNull If true it will return an error image insted of null.
   *@version 1.32
   */
  public static BufferedImage getImage(String nom, boolean returnImageNull){
<span class="fc" id="L76">    BufferedImage imgr = null;</span>
<span class="fc bfc" id="L77" title="All 2 branches covered.">    if(REP_TEXTUREPACK!=null){imgr = getImage(nom,REP_TEXTUREPACK);}</span>
<span class="fc bfc" id="L78" title="All 2 branches covered.">    if(imgr==null){imgr = getImage(nom,REP_STABLE);}</span>
<span class="fc bfc" id="L79" title="All 2 branches covered.">    if(imgr==null){imgr = getImage(nom,REP_TEMPORARY);}//si on ne l'as pas trouvé dans le 1a répertoire on vas chercher dans le 2a.</span>
<span class="pc bpc" id="L80" title="1 of 4 branches missed.">    if(imgr==null &amp;&amp; returnImageNull){imgr = readImage(new File(REP_STABLE+&quot;null.png&quot;));}</span>
<span class="fc" id="L81">    return imgr;</span>
  }
<span class="fc" id="L83">  public static BufferedImage getImage(String nom){return getImage(nom,true);}</span>
  /**
   *{@summary get an Image in a directory.}&lt;br&gt;
   *Image are File who end with &quot;.png&quot; or &quot;.jpg&quot;.&lt;br&gt;
   *.png or .jpg do not need to be precised on the name.&lt;br&gt;
   *@param nom Name of the file without REP_STABLE part.
   *@param repTemp directory were to search.
   *@version 1.3
   */
  public static BufferedImage getImage(String nom, String repTemp){
<span class="fc" id="L93">    BufferedImage imgr = null;</span>
<span class="fc" id="L94">    repTemp = str.sToDirectoryName(repTemp);</span>
    // si le .png ou .jpg etc n'as pas été précisé, on teste les 2 terminaison (.png d'habord).
<span class="pc bpc" id="L96" title="1 of 4 branches missed.">    if(str.contient(nom,&quot;.png&quot;,2) || str.contient(nom,&quot;.jpg&quot;,2)){//si on a déja un .png ou un .jpd a la fin du nom.</span>
<span class="fc" id="L97">      imgr = readImage(new File(repTemp+nom));</span>
    }else{//sinon il nous faut add l'un ou l'autre.
<span class="fc" id="L99">      String nomTemp = nom + &quot;.png&quot;;</span>
<span class="fc" id="L100">      File f = new File(repTemp+nomTemp);</span>
<span class="fc bfc" id="L101" title="All 2 branches covered.">      if(f.exists()){</span>
<span class="fc" id="L102">        imgr = readImage(f);</span>
      }else{
<span class="fc" id="L104">        nomTemp = nom + &quot;.jpg&quot;;</span>
<span class="fc" id="L105">        f = new File(repTemp+nomTemp);</span>
<span class="pc bpc" id="L106" title="1 of 2 branches missed.">        if(f.exists()){</span>
<span class="nc" id="L107">          imgr = readImage(f);</span>
        }else{
<span class="fc" id="L109">          return null;</span>
        }
      }
    }
<span class="fc" id="L113">    return imgr;</span>
  }
  /**
   *{@summary get an array [] of Image.}&lt;br&gt;
   *Image are File who end with &quot;.png&quot; or &quot;.jpg&quot;
   *@param nom Name of the file without REP_STABLE part and number and .png or .jpg part of it.
   *@param nbr Number of image that we want.
   *@param lettre A letter that can be after the number on rotated image file. ' ' or 'ø' if there is no letter after the number.
   *@param x Needed only if x!=0. x is the 1a number of the numbering.
   *@version 1.3
   */
  public static BufferedImage [] getImages(String nom,char lettre, int nbr, byte x){
<span class="fc" id="L125">    BufferedImage tr [] = new BufferedImage [nbr];int k=x;</span>
<span class="fc bfc" id="L126" title="All 2 branches covered.">    for (int i=0;i&lt;nbr ;i++ ) {</span>
<span class="fc" id="L127">      String s = nom+k+lettre;</span>
<span class="pc bpc" id="L128" title="1 of 4 branches missed.">      if(lettre==' ' || lettre=='ø'){ s = nom+k;}</span>
<span class="fc" id="L129">      tr[i] = getImage(s);k++;</span>
    }
<span class="fc" id="L131">    return tr;</span>
  }
<span class="fc" id="L133">  public static BufferedImage [] getImages(String nom, int nbr, byte x){ return getImages(nom,' ',nbr,x);}</span>
<span class="fc" id="L134">  public static BufferedImage[] getImages(String nom, byte x){return getImages(nom, getNbrImages(nom, x));}</span>
  /**
   *{@summary Fined the last existing number of image from x.}&lt;br&gt;
   *Image are File who end with &quot;.png&quot; or &quot;.jpg&quot;
   *@param nom Name of the file without REP_STABLE part and number and .png or .jpg part of it.
   *@param x Needed only if x!=0. x is the 1a number of the numbering.
   *@version 1.3
   */
  public static int getNbrImages(String nom, byte x){
<span class="fc" id="L143">    int t [] = new int [5];</span>
<span class="fc" id="L144">    t[0] = getNbrImages(nom,REP_STABLE,x);</span>
<span class="fc" id="L145">    t[1] = getNbrImages(nom,REP_TEMPORARY,x);</span>
<span class="fc" id="L146">    t[2] = getNbrImages(nom,REP_TEXTUREPACK,x);</span>
<span class="fc" id="L147">    t[3] = getNbrImages(nom,REP_TEXTUREPACK,(byte)t[0]);//il peu y avoir la suite des images des répertoires classique.</span>
<span class="fc" id="L148">    t[4] = getNbrImages(nom,REP_TEXTUREPACK,(byte)t[1]);</span>
<span class="fc" id="L149">    return math.max(t);</span>
<span class="fc" id="L150">  }public static int getNbrImages(String n){return getNbrImages(n,(byte)0);}</span>
  /**
   *{@summary Fined the last existing number of image from x on a directory}&lt;br&gt;
   *Image are File who end with &quot;.png&quot; or &quot;.jpg&quot;
   *@param nom Name of the file without REP_STABLE part and number and .png or .jpg part of it.
   *@param REP_STABLE Directory name.
   *@param x Needed only if x!=0. x is the 1a number of the numbering.
   *@version 1.3
   */
  public static int getNbrImages(String nom, String REP_STABLE, byte x){
<span class="fc" id="L160">    int nbr = x;</span>
<span class="fc" id="L161">    File f = new File(REP_STABLE+nom+nbr+&quot;.png&quot;);</span>
<span class="fc" id="L162">    File f2 = new File(REP_STABLE+nom+nbr+&quot;.jpg&quot;);</span>
<span class="pc bpc" id="L163" title="1 of 4 branches missed.">    while(f.exists() || f2.exists()){</span>
<span class="fc" id="L164">      f = new File(REP_STABLE+nom+nbr+&quot;.png&quot;);</span>
<span class="fc" id="L165">      f2 = new File(REP_STABLE+nom+nbr+&quot;.jpg&quot;);</span>
<span class="fc" id="L166">      nbr++;</span>
<span class="fc" id="L167">    }nbr--; //on compense le cran de trop.</span>
<span class="fc bfc" id="L168" title="All 2 branches covered.">    if(nbr==x-1){return 0;}//si on est jamais entré dans la boucle.</span>
<span class="fc" id="L169">    return math.max(nbr,0);</span>
<span class="fc" id="L170">  }public static int getNbrImages(String n, String REP_STABLE){return getNbrImages(n,REP_STABLE,(byte)0);}</span>
<span class="fc" id="L171">  public static BufferedImage[] getImages(String nom, int nbr){ return getImages(nom,nbr,(byte)0);}</span>
<span class="fc" id="L172">  public static BufferedImage[] getImages(String nom){ return getImages(nom,(byte)0);}</span>
  /**
   *{@summary get an array [][] of Image.}&lt;br&gt;
   *Image are File who end with &quot;.png&quot; or &quot;.jpg&quot;&lt;br&gt;
   *This metode will always return a new Image [4][nbr] to have the 4 rotated images.
   *@param nom Name of the file without REP_STABLE part and number and .png or .jpg part of it.
   *@param nbr Number of image that we want.
   *@param x Needed only if x!=0. x is the 1a number of the numbering.
   *@version 1.3
   */
  public static BufferedImage[][] getImagess(String nom, int nbr, byte x){
<span class="fc" id="L183">    BufferedImage tr [][]= new BufferedImage[4][];</span>
    //nom = &quot;temporaire/&quot;+nom;
<span class="fc" id="L185">    tr[0] = getImages(nom,'h',nbr,x);</span>
<span class="fc bfc" id="L186" title="All 2 branches covered.">    if(Main.getElementSurCarteOrientéAprèsDéplacement()){</span>
<span class="fc" id="L187">      tr[1] = getImages(nom,'d',nbr,x);</span>
<span class="fc" id="L188">      tr[2] = getImages(nom,'b',nbr,x);</span>
<span class="fc" id="L189">      tr[3] = getImages(nom,'g',nbr,x);</span>
    }
<span class="fc" id="L191">    return tr; // tr[1] et plus est null si l'orrientation n'est pas prise en compte.</span>
  }

<span class="nc" id="L194">  public static BufferedImage[][] getImagess(String nom, int nbr){ return getImagess(nom,nbr,(byte)0);}</span>
<span class="fc" id="L195">  public static BufferedImage[][] getImagess(String nom){ return getImagess(nom,(byte)0);}</span>
<span class="fc" id="L196">  public static BufferedImage[][] getImagess(String nom, byte x){ return getImagess(nom,getNbrImages(nom),x);}</span>
  /**
   *{@summary transforme to Scaled instance a Image []}&lt;br&gt;
   *@param width the width to which to scale the image.
   *@param heigth the height to which to scale the image.
   *@param hints flags to indicate the type of algorithm to use for image resampling.
   *@version 1.3
   */
  public static BufferedImage [] getScaledInstance(BufferedImage img [],int width, int heigth, int hints){
<span class="nc" id="L205">    int len = img.length;</span>
<span class="nc bnc" id="L206" title="All 2 branches missed.">    for (int i=0;i&lt;len ;i++ ) {</span>
<span class="nc" id="L207">      img[i].getScaledInstance(width,heigth,hints);</span>
    }
<span class="nc" id="L209">    return img;</span>
  }
  /**
   *{@summary delete every file in REP_TEMPORARY.}&lt;br&gt;
   *@version 1.3
   */
  public static void clearTemporaire(){
<span class="fc" id="L216">    File docier = new File(REP_TEMPORARY);</span>
<span class="fc" id="L217">    File[] fichiers = docier.listFiles();</span>
<span class="fc bfc" id="L218" title="All 2 branches covered.">    for (File f : fichiers ) {</span>
<span class="fc bfc" id="L219" title="All 2 branches covered.">      if(isImage(f)){f.delete();}</span>
    }
<span class="fc" id="L221">  }</span>
  /**
   *{@summary delete every FSomething file in REP_TEMPORARY.}&lt;br&gt;
   *@version 1.3
   */
  public static void clearPartielTemporaire(){
<span class="fc" id="L227">    File docier = new File(REP_TEMPORARY);</span>
<span class="fc" id="L228">    File[] fichiers = docier.listFiles();</span>
<span class="fc bfc" id="L229" title="All 2 branches covered.">    for (File f : fichiers ) {</span>
<span class="fc bfc" id="L230" title="All 2 branches covered.">      if(str.contient(f.getName(),&quot;F&quot;,0)){//si c'est une fourmi. (= si le fichier commence par &quot;F&quot;)</span>
<span class="fc bfc" id="L231" title="All 2 branches covered.">        if(isImage(f)){f.delete();}</span>
      }
    }
<span class="fc" id="L234">  }</span>
  //taille d'une image de Creature.
  /**
   *{@summary Return size of a Creature image.}&lt;br&gt;
   *@param idEspece id of the Species (size depend of Species)&lt;br&gt;
   *@param stade stade also infulence size of the Creature
   *@param taille taille used if it was 0% realistic.
   *@version 1.3
   */
  public static int taille(int idEspece, int stade,int taille){
<span class="nc" id="L244">    int a = Main.getEspeceParId(idEspece).getTaille(stade);//la taille en fonction du stade (100 en moyenne.)</span>
<span class="nc" id="L245">    return taille(a,taille);</span>
  }
  /**
   *{@summary Return size of a Creature image.}&lt;br&gt;
   *@param a size assumed if it was 100% realistic.
   *@param taille size used if it was 0% realistic.
   *@version 1.3
   */
  public static int taille(int a,int taille){
<span class="fc" id="L254">    double tailleR = Main.getOp().getTailleRealiste()/100.0;</span>
<span class="fc" id="L255">    double db = ((a*taille*tailleR)/100) + (taille)*(1-tailleR);//en pixel on fait *4.</span>
<span class="fc" id="L256">    return (int)db;</span>
  }
  public static boolean isImage(File f){//2 possibilité, le fichier ce termine par .pnj ou par .jpg.
<span class="pc bpc" id="L259" title="1 of 2 branches missed.">    if(f==null){return false;}</span>
<span class="fc bfc" id="L260" title="All 2 branches covered.">    if(str.contient(f.getName(),&quot;.png&quot;,2)){return true;}</span>
<span class="fc bfc" id="L261" title="All 2 branches covered.">    if(str.contient(f.getName(),&quot;.jpg&quot;,2)){return true;}</span>
<span class="fc" id="L262">    return false;</span>
  }
  /*public BufferedImage rognerImage(BufferedImage i){
    Img img = new Img(i);
    img.rognerBordTransparent();
    img.actualiserImage();
    img.sauvegarder(&quot;tempFromImage&quot;);
    try {
      File f = new File(REP_STABLE+&quot;tempFromImage.png&quot;);
      if(isImage(f)){
        BufferedImage i2 = getImage(&quot;tempFromImage&quot;);
        return i2;
      }else{
        erreur.erreur(&quot;impossible de charger l'image correctement&quot;,&quot;image.rognerImage&quot;);
      }
    }catch (Exception e) {
      erreur.erreur(&quot;impossible de charger l'image correctement&quot;,&quot;image.rognerImage&quot;);
    }
    return i;
  }*/
  /**
  *{@summary A fonction to getScaledInstance and return a BufferedImage.} &lt;br&gt;
  *If images is alredy resize to the exacte dimention it only return the same image.&lt;br&gt;
  *cf https://stackoverflow.com/questions/9417356/bufferedimage-resize/9417836#9417836&lt;br&gt;
  *@param bi The Image to resize.
  *@param newW The new width.
  *@param newH The new height.
  *@version 1.31
  */
  public static BufferedImage resize(BufferedImage bi, int newW, int newH) {
<span class="pc bpc" id="L292" title="1 of 2 branches missed.">    if(bi==null){return null;}</span>
<span class="pc bpc" id="L293" title="3 of 4 branches missed.">    if(newW==bi.getWidth() &amp;&amp; newH==bi.getHeight()){return bi;}</span>
<span class="fc bfc" id="L294" title="All 2 branches covered.">    if(newW&lt;1){newW=1;}</span>
<span class="fc bfc" id="L295" title="All 2 branches covered.">    if(newH&lt;1){newH=1;}</span>
<span class="fc" id="L296">    Image tmp = bi.getScaledInstance(newW, newH, Image.SCALE_SMOOTH);</span>
<span class="fc" id="L297">    BufferedImage dimg = new BufferedImage(newW, newH, BufferedImage.TYPE_INT_ARGB);</span>

<span class="fc" id="L299">    Graphics2D g2d = dimg.createGraphics();</span>
<span class="fc" id="L300">    g2d.drawImage(tmp, 0, 0, null);</span>
<span class="fc" id="L301">    g2d.dispose();</span>

<span class="fc" id="L303">    return dimg;</span>
  }
  /**
  *{@summary A fonction to getScaledInstance and return a BufferedImage.}&lt;br&gt;
  *This function use resize(bufferedImage, width, height).&lt;br&gt;
  *This function resize the biger side to newHW &amp;#38; the other size to keep the proportions.&lt;br&gt;
  *@param bi The Image to resize.
  *@param newHW The new height or width (biger side).
  *@version 1.31
  */
  public static BufferedImage resize(BufferedImage bi, int newHW){
<span class="fc bfc" id="L314" title="All 2 branches covered.">    if(bi==null){return null;}</span>
    int newW;
    int newH;
<span class="fc bfc" id="L317" title="All 2 branches covered.">    if(bi.getWidth()&gt;bi.getHeight()){</span>
<span class="fc" id="L318">      newW = newHW;</span>
<span class="fc" id="L319">      newH = newHW*bi.getHeight()/bi.getWidth(); //a smaler size.</span>
    }else{
<span class="fc" id="L321">      newH = newHW;</span>
<span class="fc" id="L322">      newW = newHW*bi.getWidth()/bi.getHeight(); //a smaler size.</span>
    }
<span class="fc" id="L324">    double racioWH = bi.getWidth()/bi.getHeight();</span>
<span class="fc" id="L325">    return resize(bi,newW,newH);</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>