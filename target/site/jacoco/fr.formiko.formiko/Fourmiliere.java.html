<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Fourmiliere.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Formiko</a> &gt; <a href="index.source.html" class="el_package">fr.formiko.formiko</a> &gt; <span class="el_source">Fourmiliere.java</span></div><h1>Fourmiliere.java</h1><pre class="source lang-java linenums">package fr.formiko.formiko;

import fr.formiko.formiko.Main;
import fr.formiko.usuel.debug;
import fr.formiko.usuel.erreur;
import fr.formiko.usuel.g;
import fr.formiko.usuel.exceptions.NotNullLocationException;
import fr.formiko.usuel.listes.GGInt;
import fr.formiko.usuel.listes.GInt;
import fr.formiko.usuel.maths.allea;

import java.io.Serializable;

public class Fourmiliere implements Serializable{
  //Les données communes a chaque Fourmiliere :
  /***
  *Counter of id.
  */
  private static int idCpt;
  /***
  *Unic id of the Fourmiliere.
  */
  private final int id;
  /***
  *Place on the map
  */
  private CCase ccase;
  /***
  *Player that own this.
  */
  private Joueur joueur;
  /***
  *List of the Creature own by the Fourmiliere
  */
  private GCreature gc;
  /***
  *List of the Graine own by the Fourmiliere
  */
  private GGraine gg;
  //private byte modeDéfaut;
  /***
  *List of the Scores turn by turn of the Fourmiliere
  */
  private GGInt ggi;
  /***
  *Number of died ant.
  */
  private int nbrFourmisMorte;

  // CONSTRUCTEUR
<span class="fc" id="L51">  public Fourmiliere(CCase ccase, Joueur j){</span>
<span class="fc" id="L52">    id = idCpt; idCpt++;</span>
<span class="fc" id="L53">    nbrFourmisMorte=0;</span>
    //modeDéfaut=3;
<span class="fc" id="L55">    ggi = new GGInt();</span>
<span class="fc bfc" id="L56" title="All 2 branches covered.">    if (ccase==null){</span>
<span class="fc" id="L57">      erreur.erreur(&quot;Impossible de créer une fourmilière sur une case null&quot;,true);</span>
    }
<span class="fc" id="L59">    debug.débogage(&quot;Placement de la Fourmiliere dans la Case.&quot;);</span>
<span class="fc bfc" id="L60" title="All 4 branches covered.">    if (ccase!=null &amp;&amp; ccase.getContenu().getFere() != null){</span>
<span class="fc" id="L61">      int k=0;</span>
      do {
<span class="fc" id="L63">        ccase = Main.getGc().getCCaseAlléa();</span>
<span class="fc" id="L64">        k++;</span>
<span class="pc bpc" id="L65" title="1 of 2 branches missed.">        if(k==100){erreur.alerte(&quot;Impossible de créer une fourmilière sur une case qui en contient déjà une ! Déjà 100 tentative de placement&quot;,&quot;Choix d'une autre case alléatoire.&quot;);}</span>
<span class="fc bfc" id="L66" title="All 2 branches covered.">      } while (ccase.getContenu().getFere() != null);</span>
    }
<span class="fc" id="L68">    this.ccase = ccase;</span>
<span class="fc bfc" id="L69" title="All 2 branches covered.">    if(ccase!=null) {ccase.getContenu().setFere(this);}</span>
<span class="fc" id="L70">    joueur = j;</span>
<span class="fc" id="L71">    gc = new GCreature();</span>
<span class="fc" id="L72">    gg = new GGraine();</span>
<span class="fc" id="L73">  }</span>
  public Fourmiliere(Joueur j, Carte mapo){
<span class="fc" id="L75">    this(mapo.getGc().getCCaseAlléa(),j);</span>
<span class="fc" id="L76">  }</span>

  public Fourmiliere(int taille, Joueur j, Carte mapo){
<span class="fc" id="L79">    this(j, mapo);</span>
<span class="fc" id="L80">    int x = allea.getAlléaDansTableau(Main.getTableauDesEspecesAutorisée());</span>
<span class="pc bpc" id="L81" title="1 of 2 branches missed.">    if(!j.getIa()){x=0;}//les joueurs ne joue que des Lasius Niger</span>
<span class="fc" id="L82">    gc = new GCreature(taille, this,Main.getGEspece().getEspeceParId(x),getCCase());</span>
<span class="fc" id="L83">  }</span>
<span class="nc" id="L84">  public Fourmiliere(int taille, Joueur j){ this(taille,j,Main.getCarte());}</span>
<span class="fc" id="L85">  public Fourmiliere() {this(((CCase)(null)),null);} //Only for test</span>
  // GET SET -----------------------------------------------------------------------
<span class="fc" id="L87">  public int getId(){return id;}</span>
<span class="fc" id="L88">  public Point getP(){return getCCase().getContenu().getP();}</span>
<span class="nc" id="L89">  public Point getPoint(){return getP();}</span>
<span class="fc" id="L90">  public CCase getCc(){return ccase;}</span>
<span class="fc" id="L91">  public CCase getCCase(){return getCc();}</span>
  /**
  *{@summary Move the anthill from a case to an other.}&lt;br&gt;
  *It will not add a Fourmiliere to a case that already have 1 but throw an Exception.
  *It will try to remove from old CCase and add to new CCase.&lt;br&gt;
  *@version 1.41
  */
  public void setCc(CCase newCCase){
<span class="pc bpc" id="L99" title="1 of 4 branches missed.">    if(newCCase!=null &amp;&amp; newCCase.getContenu()!=null){</span>
<span class="fc bfc" id="L100" title="All 2 branches covered.">      if(equals(newCCase.getContenu().getFere())){return;}</span>
<span class="fc bfc" id="L101" title="All 2 branches covered.">      if(newCCase.getContenu().getFere()!=null){throw new NotNullLocationException();}</span>
    }
<span class="fc bfc" id="L103" title="All 2 branches covered.">    if (getCCase()!=null) {</span>
<span class="fc" id="L104">      getCCase().getContenu().setFere(null);</span>
    }
<span class="fc" id="L106">    ccase = newCCase;</span>
<span class="fc bfc" id="L107" title="All 2 branches covered.">    if (newCCase!=null){</span>
<span class="fc" id="L108">      newCCase.getContenu().setFere(this);</span>
    }
<span class="fc" id="L110">  }public void setCCase(CCase ccase){setCc(ccase);}</span>
<span class="nc" id="L111">  public static int getI(){return idCpt;}</span>
<span class="nc" id="L112">  public int getNbrDeFourmi(){return length();}</span>
<span class="nc" id="L113">  public int getLen(){return length();}</span>
<span class="fc" id="L114">  public int length(){return gc.length();}</span>
<span class="fc" id="L115">  public void setJoueur(Joueur j){joueur = j;}</span>
<span class="fc" id="L116">  public Joueur getJoueur(){return joueur;}</span>
<span class="fc" id="L117">  public GCreature getGc(){return gc;}</span>
<span class="nc" id="L118">  public Creature getReine(){ return gc.getReine();}// on part du principe qu'il n'y a qu'une reine.</span>
<span class="nc" id="L119">  public GGraine getGg(){return gg;} public GGraine getGGraine(){ return getGg();}</span>
<span class="nc" id="L120">  public void setGg(GGraine gg){ this.gg = gg;}</span>
<span class="nc" id="L121">  public void setLienFere(){ gc.setLienFere(this);}</span>
  public Pheromone getPh(){
<span class="nc bnc" id="L123" title="All 2 branches missed.">    if(getReine()!=null){return getReine().getPh();}</span>
<span class="nc bnc" id="L124" title="All 2 branches missed.">    else if(getGc().getDébut()!=null){return getGc().getDébut().getContenu().getPh();}</span>
<span class="nc" id="L125">    else{return new Pheromone(0,0,0);}</span>
  }
  public int getScore(){
    try {
<span class="nc" id="L129">      return ggi.getFin().getContenu().calculerScore(this);</span>
<span class="nc" id="L130">    }catch (NullPointerException e) {</span>
<span class="nc" id="L131">      ggi.add(new GInt(this));</span>
<span class="nc" id="L132">      return ggi.getFin().getContenu().calculerScore(this);</span>
    }
  }
<span class="fc" id="L135">  public int getNbrFourmisMorte(){return nbrFourmisMorte;}</span>
<span class="fc" id="L136">  public void setNbrFourmisMorte(int x){nbrFourmisMorte=x;}</span>
<span class="fc" id="L137">  public void nbrFourmisMortePlus1(){setNbrFourmisMorte(getNbrFourmisMorte()+1);}</span>
<span class="nc" id="L138">  public Espece getEspece(){return gc.getEspece();}</span>
<span class="fc" id="L139">  public static void ini(){idCpt=1;}</span>
  // Fonctions propre -----------------------------------------------------------
  /**
  *{@summary Return a description of the Fourmiliere.}&lt;br&gt;
  *@param b If true we also return all the descriptions of the ants of the Fourmiliere.
  *@version 1.31
  */
  public String toString(boolean b){
<span class="fc" id="L147">    int leng = length();</span>
<span class="pc bpc" id="L148" title="1 of 2 branches missed.">    String s = (joueur.getIa()) ? &quot;IA&quot; : &quot;Joueur&quot;;</span>
<span class="fc" id="L149">    String sr = g.getM(&quot;la&quot;)+&quot; &quot;+g.get(&quot;fourmilière&quot;)+&quot; &quot;+ id +&quot; (&quot;+s+&quot;) &quot;+g.get(&quot;aPourCoordonnées&quot;)+&quot; : &quot;+ getP().toString() +&quot; &quot;+g.get(&quot;et&quot;)+&quot; &quot;+g.get(&quot;contient&quot;)+&quot; &quot;+leng+&quot; &quot;+g.get(&quot;fourmis&quot;)+&quot;.&quot;+&quot;\n&quot;;</span>
<span class="pc bpc" id="L150" title="1 of 2 branches missed.">    if(b){sr+=gc.toString();}</span>
<span class="fc" id="L151">    sr+=gg.toString();</span>
<span class="fc" id="L152">    return sr;</span>
  }
  /**
  *{@summary Return a description of the Fourmiliere.}&lt;br&gt;
  *@version 1.31
  */
  public String toString(){
<span class="nc" id="L159">    return toString(true);</span>
  }
  /**
  *{@summary Let all ant play.}&lt;br&gt;
  *Before that ants play they all have a pre-turn update (gc.preTour()).&lt;br&gt;
  *Ants do not necessarily play in order so we way for aFiniDeJouer() to end turn.&lt;br&gt;
  *At the end of the Fourmiliere turn we add a line to there stats (How many ant are alive and what stade).
  *@version 1.31
  */
  public void jouer(){
<span class="nc bnc" id="L169" title="All 2 branches missed.">    if(gc.length()==0){return;}</span>
    //this.setModeDéfaut(3); //tant que tous le couvains n'aura pas été dorloté.
<span class="nc" id="L171">    gc.preTour();</span>
    do {
<span class="nc" id="L173">      gc.jouer();</span>
<span class="nc bnc" id="L174" title="All 2 branches missed.">    } while (!gc.aFiniDeJouer());</span>
    //gc.finTour();
<span class="nc" id="L176">    ggi.add(new GInt(this)); //stats of this turn</span>
<span class="nc" id="L177">  }</span>
  /*public void faireVarierLesAge(){
  }
  public void faireVarierLesPoint(){
  }*/
<span class="nc" id="L182">  public void déposer(Graine g){gg.add(g); }</span>
  /**
  *{@summary Save stats/score in the GGInt.}&lt;br&gt;
  *@version 1.31
  */
  public String enregistrerLesScores(){
<span class="nc" id="L188">    return ggi.toString();</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>