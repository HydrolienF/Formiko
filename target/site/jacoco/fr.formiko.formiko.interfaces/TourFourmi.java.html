<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TourFourmi.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Formiko</a> &gt; <a href="index.source.html" class="el_package">fr.formiko.formiko.interfaces</a> &gt; <span class="el_source">TourFourmi.java</span></div><h1>TourFourmi.java</h1><pre class="source lang-java linenums">package fr.formiko.formiko.interfaces;

import fr.formiko.formiko.*;
import fr.formiko.usuel.debug;
import fr.formiko.usuel.erreur;
import fr.formiko.usuel.exceptions.ListItemNotFoundException;
import fr.formiko.usuel.exceptions.ClassTypeException;
import fr.formiko.usuel.exceptions.EmptyListException;

import java.io.Serializable;

/**
 * {@summary Ant implementation.&lt;br/&gt;}
 * Allow an ant to play a turn&lt;br/&gt;
 * @author Hydrolien
 * @version 1.30
 */
<span class="fc" id="L18">public class TourFourmi implements Serializable, Tour{</span>
  protected Fourmi f;
<span class="fc" id="L20">  public void setF(Fourmi fTemp){f=fTemp;}</span>
  /**
  *PLay 1 turn with Creature f.
  *@version 1.24
  */
  public void unTour(Creature c){
<span class="fc" id="L26">    debug.débogage(&quot;la créature &quot;+c.getId()+&quot; tente de jouer un tour&quot;);</span>
<span class="pc bpc" id="L27" title="1 of 2 branches missed.">    if(c==null){throw new NullPointerException();}</span>
<span class="fc bfc" id="L28" title="All 2 branches covered.">    if(!(c instanceof Fourmi)){throw new ClassTypeException(&quot;Fourmi&quot;,&quot;Creature&quot;);}</span>
<span class="fc" id="L29">    setF((Fourmi) c);</span>
<span class="fc" id="L30">    tour();</span>
<span class="fc" id="L31">    debug.débogage(&quot;fin du tour de la fourmi.&quot;);</span>
<span class="fc" id="L32">  }</span>

  /**
  *{@summary Do turn actions for an ant.}
  *&lt;ul&gt;
  *&lt;li&gt;1a the ant try to survive.
  *&lt;li&gt;Then it help any friendly ant in the same case.
  *&lt;li&gt;Then it get more food.
  *&lt;li&gt;Finaly it back home and share food with other.
  *&lt;/ul&gt;
  *@version 1.29
  */
  public void tour(){
<span class="fc" id="L45">    f.eat(5); //if granivore go back to anthill if anthill have oppen seed or oppenable seed.</span>
<span class="fc" id="L46">    f.runAway();</span>
<span class="fc" id="L47">    cleanItself();</span>
<span class="fc" id="L48">    f.eat(20);</span>
<span class="fc" id="L49">    feedOther(10); //if granivore do not feedOther out of anthill</span>
<span class="fc" id="L50">    cleanOther();</span>
<span class="fc" id="L51">    f.eat(80);</span>
    //reproduce();
<span class="fc" id="L53">    backHomeAndShareFood(); //if granivore oppen seed &amp; feedOther.</span>
<span class="fc" id="L54">    f.eat(100);</span>
<span class="fc" id="L55">    finTour();</span>
<span class="fc" id="L56">  }</span>
  /**
  *{@summary To be sur that the ant will be clean.}&lt;br&gt;
  *@version 1.29
  */
  public void cleanItself(){
<span class="fc bfc" id="L62" title="All 6 branches covered.">    while(f.getAction()&gt;0 &amp;&amp; f.wantClean() &amp;&amp; !(f.netoyer instanceof NetoyerNull)){ f.ceNetoyer();}</span>
<span class="fc" id="L63">  }</span>
  /**
  *{@summary Give food by trophallaxis if other ant need it.}&lt;br&gt;
  *An Ant try to give all it food exept foodToQueep%.&lt;br&gt;
  *An ant try to give food if : it have action left, it have more food than foodToQueep%, it can use Trophallaxie interface.
  *@version 1.29
  */
  public void feedOther(int foodToQueep){
<span class="pc bpc" id="L71" title="1 of 6 branches missed.">    while(f.getAction()&gt;0 &amp;&amp; !(f.isHungry(foodToQueep)) &amp;&amp; !(f.trophallaxie instanceof TrophallaxieNull)){</span>
<span class="fc" id="L72">      Creature toFeed = aNourrir();</span>
<span class="fc bfc" id="L73" title="All 2 branches covered.">      if(toFeed==null){return;}</span>
<span class="fc" id="L74">      int givenFood = f.getNourriture()-((f.getNourritureMax()*foodToQueep)/100);</span>
<span class="pc bpc" id="L75" title="1 of 2 branches missed.">      if(givenFood&lt;1){return;}</span>
<span class="fc" id="L76">      f.trophallaxie(toFeed,givenFood);</span>
<span class="fc" id="L77">    }</span>
<span class="fc" id="L78">  }</span>
  /**
  *{@summary Search the ant that need the more food.}&lt;br&gt;
  *We 1a feed our ant queen if it wantFood.&lt;br&gt;
  *We 2a feed every creature that is concidered as an ally &amp;#38; want food.&lt;br&gt;
  *Finaly we try to feed the queen even if she didn't absolutly need food.&lt;br&gt;
  *@version 1.29
  */
  public Creature aNourrir(){
<span class="fc" id="L87">    GCreature gc = f.getCCase().getContenu().getGc().filtreAlliés(f).filtreFaimMax();</span>
    try { // the Creature f may not be in it.
<span class="fc" id="L89">      gc.remove(f);</span>
<span class="fc" id="L90">    }catch (ListItemNotFoundException e) {</span>
<span class="pc" id="L91">    }catch (EmptyListException e) {}</span>
<span class="fc" id="L92">    Creature r = gc.getReine();</span>
<span class="pc bpc" id="L93" title="1 of 4 branches missed.">    if (r!=null &amp;&amp; r.wantFood()) {</span>
<span class="fc" id="L94">      return r;</span>
    }
<span class="fc" id="L96">    GCreature gc2 = gc.filtreWantFood();</span>
<span class="fc bfc" id="L97" title="All 2 branches covered.">    if(gc2.getDébut()!=null){</span>
<span class="fc" id="L98">      return gc2.getDébut().getContenu();</span>
    }
<span class="fc" id="L100">    return r; //r can be null.</span>
  }
  /**
  *{@summary Clean if other ant need it.}&lt;br&gt;
  *@version 1.29
  */
  public void cleanOther(){
<span class="pc bpc" id="L107" title="1 of 4 branches missed.">    while(f.getAction()&gt;0 &amp;&amp; !(f.netoyer instanceof NetoyerNull)){</span>
<span class="fc" id="L108">      Creature toClean = aNetoyer();</span>
<span class="fc bfc" id="L109" title="All 2 branches covered.">      if(toClean==null){return;}</span>
<span class="fc" id="L110">      f.netoyer(toClean);</span>
<span class="fc" id="L111">    }</span>
<span class="fc" id="L112">  }</span>
  /**
  *{@summary Search the ant that need the more to be clean.}&lt;br&gt;
  *We 1a clean our ant queen if it wantClean.&lt;br&gt;
  *We 2a clean every creature that is concidered as an ally &amp;#38; want clean.&lt;br&gt;
  *@version 1.29
  */
  public Creature aNetoyer(){
<span class="fc" id="L120">    GCreature gc = f.getCCase().getContenu().getGc().filtreAlliés(f).filtrePropreteMax();</span>
    try { // the Creature f may not be in it.
<span class="fc" id="L122">      gc.remove(f);</span>
<span class="fc" id="L123">    }catch (ListItemNotFoundException e) {</span>
<span class="fc" id="L124">    }catch (EmptyListException e) {}</span>
<span class="fc" id="L125">    Creature r = gc.getReine();</span>
<span class="pc bpc" id="L126" title="3 of 4 branches missed.">    if (r!=null &amp;&amp; r.wantClean()) {</span>
<span class="nc" id="L127">      return r;</span>
    }
<span class="fc" id="L129">    GCreature gc2 = gc.filtreWantClean();</span>
<span class="fc bfc" id="L130" title="All 2 branches covered.">    if(gc2.getDébut()!=null){</span>
<span class="fc" id="L131">      return gc2.getDébut().getContenu();</span>
    }
<span class="fc" id="L133">    return null;</span>
  }
  /**
  *{@summary Back home and share food to the Creature that need it.}&lt;br&gt;
  *@version 1.29
  */
  public void backHomeAndShareFood(){
<span class="fc" id="L140">    backHome();</span>
<span class="fc" id="L141">    feedOther(10);</span>
<span class="fc" id="L142">    cleanOther();</span>
<span class="fc" id="L143">  }</span>
  /**
  *{@summary Back home.}&lt;br&gt;
  *We find the direction to be closer to the anthill. And then we go there. &lt;br&gt;
  *@version 1.29
  */
  public void backHome(){
<span class="fc bfc" id="L150" title="All 4 branches covered.">    while (f.getAction()&gt;0 &amp;&amp; !f.estALaFere()) {</span>
<span class="fc" id="L151">      int directionDeLaFourmilière = f.getCCase().getDirection(f.getFourmiliere().getCCase());</span>
<span class="fc" id="L152">      f.ceDeplacer(directionDeLaFourmilière);</span>
<span class="fc" id="L153">    }</span>
<span class="fc" id="L154">  }</span>
  /**
  *{@summary End a turn as an Ant.}&lt;br&gt;
  *@version 1.30
  */
  public void finTour(){
<span class="fc" id="L160">    debug.débogage(&quot;Fin du tour de la Fourmi&quot;);</span>
<span class="fc bfc" id="L161" title="All 2 branches covered.">    if(f.getAction()&gt;0){f.setAction(0);}//end the turn normaly</span>
    // Un tour ça coute en age et en nourriture;
<span class="pc bpc" id="L163" title="1 of 6 branches missed.">    if (!(f.evoluer instanceof EvoluerNull) &amp;&amp; f.getStade()&lt;0 &amp;&amp; f.getAge()&gt;=f.getAgeMax()){ f.evoluer();}</span>
<span class="fc" id="L164">    f.setAgePlus1(); f.salir();</span>
<span class="fc" id="L165">    f.setNourritureMoinsConsomNourriture(); //will not ask food is it's an egg.</span>
    // if contition de température appartient a l'intervale idéale (et que stade = -1, -2 ou -3) : re setAgePlus1();
    try { //TODO move that to ViewGUI
<span class="fc bfc" id="L168" title="All 2 branches covered.">      if (!f.getFere().getJoueur().getIa()) { //pour un joueur humain.</span>
<span class="nc" id="L169">        Main.getPj().setFActuelle(null);</span>
<span class="nc" id="L170">        Main.getPb().setVisiblePa(false);</span>
      }
<span class="nc" id="L172">      Main.getPs().setIdFourmiAjoué(-1);</span>
<span class="fc" id="L173">    }catch (Exception e) {</span>
<span class="fc" id="L174">      erreur.alerteGUI2Dfail(&quot;TourFourmi&quot;);</span>
<span class="nc" id="L175">    }</span>
<span class="fc" id="L176">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>