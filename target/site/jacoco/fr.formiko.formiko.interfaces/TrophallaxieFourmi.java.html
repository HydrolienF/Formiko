<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TrophallaxieFourmi.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Formiko</a> &gt; <a href="index.source.html" class="el_package">fr.formiko.formiko.interfaces</a> &gt; <span class="el_source">TrophallaxieFourmi.java</span></div><h1>TrophallaxieFourmi.java</h1><pre class="source lang-java linenums">package fr.formiko.formiko.interfaces;

import fr.formiko.formiko.Creature;
import fr.formiko.formiko.Fourmi;
import fr.formiko.formiko.GCreature;
import fr.formiko.formiko.Main;
import fr.formiko.views.gui2d.BoiteListeDefilante;
import fr.formiko.views.gui2d.PanneauTInt;
import fr.formiko.usuel.debug;
import fr.formiko.usuel.erreur;
import fr.formiko.usuel.g;
import fr.formiko.usuel.maths.math;
import fr.formiko.usuel.tableau;

import java.io.Serializable;

/**
 * {@summary Ant implementation.}&lt;br&gt;
 * Allow an ant to do a trophallaxis&lt;br&gt;
 * @author Hydrolien
 * @version 1.1
 */
<span class="fc" id="L23">public class TrophallaxieFourmi implements Serializable, Trophallaxie {</span>
  /**
   *{@summary make a trophallaxis.}&lt;br&gt;
   *This methode will check that no food will be lost and no food will be create.&lt;br&gt;
   *If the trophallaxis work well it will cost action to the 2 creatures.
   *@param c The trophallaxing Creature.
   *@param c2 The target of the trophallaxie.
   *@param nourritureDonnée The amount of food transferred.
   *@version 1.3
   */
  public void trophallaxie(Creature c, Creature c2, int nourritureDonnée){
<span class="pc bpc" id="L34" title="2 of 4 branches missed.">    if (c==null || c2 == null){ erreur.alerte(&quot;Une des créatures impliqués dans la Trophalaxie n'as pas pue être trouvé&quot;);return;}</span>
<span class="pc bpc" id="L35" title="1 of 2 branches missed.">    if (nourritureDonnée &lt; 1){ erreur.alerte(&quot;Impossible de trophallaxer une quantité négtive ou nul de nourriture&quot;); return;}</span>
<span class="fc" id="L36">    debug.débogage(&quot;Trophallaxie de &quot;+nourritureDonnée+ &quot; souhaité, de &quot;+c.getId()+&quot; vers &quot;+c2.getId());</span>
<span class="fc" id="L37">    debug.débogage(&quot;Lancement de la trophallaxie de la créature &quot;+c.getId()+&quot; vers la créature &quot;+c2.getId() +&quot; transfère de &quot;+nourritureDonnée +&quot; voulu&quot;);</span>
<span class="pc bpc" id="L38" title="1 of 2 branches missed.">    if(!(c instanceof Fourmi)){erreur.alerte(&quot;Impossible de trophallaxer depuis une créature qui n'est pas une Fourmi&quot;);return;}</span>
<span class="fc" id="L39">    Fourmi f1 = (Fourmi) c;</span>
<span class="pc bpc" id="L40" title="1 of 2 branches missed.">    if (f1.getNourriture() &lt; nourritureDonnée){ // si f1 donne trop</span>
<span class="nc" id="L41">      erreur.erreur(&quot;Une fourmi a voulu donnée plus de nourriture que ce qu'elle a&quot;,&quot;Elle ne donnera que la moitié de sa nourriture par mesure de précaution&quot;);</span>
<span class="nc" id="L42">      nourritureDonnée = f1.getNourriture()/2;</span>
    }
<span class="fc bfc" id="L44" title="All 2 branches covered.">    if ((c2.getNourritureMax() - c2.getNourriture()) &lt; nourritureDonnée){ // si c2 ne peu pas tt recevoir</span>
<span class="fc" id="L45">      nourritureDonnée = c2.getNourritureMax() - c2.getNourriture();</span>
    }
<span class="fc" id="L47">    f1.setNourriture(f1.getNourriture()-nourritureDonnée);</span>
<span class="fc" id="L48">    c2.setNourriture(c2.getNourriture()+nourritureDonnée);</span>
<span class="pc bpc" id="L49" title="1 of 2 branches missed.">    if(nourritureDonnée&gt;0){</span>
<span class="fc" id="L50">      f1.setActionMoins(f1.getEspece().getGIndividu().getIndividuParType(((Fourmi) c).getTypeF()).getCoutTrophallaxie());</span>
<span class="pc bpc" id="L51" title="1 of 2 branches missed.">      if(c2 instanceof Fourmi){</span>
<span class="fc" id="L52">        c2.setActionMoins(f1.getEspece().getGIndividu().getIndividuParType(((Fourmi) c).getTypeF()).getCoutTrophallaxie());</span>
      }else{
<span class="nc" id="L54">        c2.setActionMoins(1);</span>
      }
    }
<span class="fc" id="L57">    debug.débogage(&quot;Trophallaxie de &quot;+nourritureDonnée+ &quot; éffectuée&quot;);</span>
<span class="fc" id="L58">  }</span>
  /**
   *{@summary do a trophallaxis to an id}&lt;br&gt;
   *@param id The target Creature to fined on the Case.
   *@version 1.3
   */
  public void trophallaxie(Creature c, int id, int nourritureDonnée){
<span class="nc" id="L65">    debug.débogage(&quot;Recherche de la créature &quot;+id+&quot; sur la case &quot;+c.getCCase().getContenu().toString());</span>
<span class="nc" id="L66">    trophallaxie(c,c.getCCase().getContenu().getGc().getCreatureParId(id), nourritureDonnée);</span>
<span class="nc" id="L67">  }</span>
  /**
   *{@summary player trophallaxis}&lt;br&gt;
   *1a find the target ant that can be chose &amp;#38; make the player chose 1.&lt;br&gt;
   *2a ask the amount of food transferred by the player.&lt;br&gt;
   *3a do the trophallaxis.&lt;br&gt;
   *@param c The creature who whant to give food.
   *@version 1.3
   */
  public void trophallaxer(Creature c){
<span class="nc bnc" id="L77" title="All 2 branches missed.">    if(!(c instanceof Fourmi)){erreur.alerte(&quot;Impossible de trophallaxer depuis une créature qui n'est pas une Fourmi&quot;);return;}</span>
<span class="nc" id="L78">    Fourmi f = (Fourmi)c;</span>
<span class="nc" id="L79">    GCreature gc = f.getCCase().getContenu().getGc().filtreAlliés(f); //ne prend que les allié.</span>
<span class="nc" id="L80">    int lengc = gc.length();</span>
<span class="nc bnc" id="L81" title="All 2 branches missed.">    if(lengc &lt; 2){</span>
<span class="nc" id="L82">      erreur.erreurGXVide(&quot;GFourmi&quot;);</span>
    }else{
      //id de la foumi cible.
<span class="nc" id="L85">      int t [] = f.getAlliéSurLaCaseSansThis().toTId(); //ne prend que les alliées.</span>
<span class="nc" id="L86">      t = getCreatureQuiOnFaim(t,c);</span>
<span class="nc" id="L87">      int lent = t.length;</span>
<span class="nc" id="L88">      String s[] = new String[lent];</span>
<span class="nc bnc" id="L89" title="All 2 branches missed.">      for (int i=0;i&lt;lent ;i++ ) {</span>
<span class="nc" id="L90">        Creature cTemp = gc.getCreatureParId(t[i]);</span>
<span class="nc" id="L91">        String sTemp = &quot;&quot;;</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">        if(cTemp instanceof Fourmi){sTemp = &quot; (&quot;+((Fourmi)(cTemp)).getStringStade()+&quot;)&quot;;}</span>
<span class="nc" id="L93">        else {sTemp = &quot; (&quot;+cTemp.getNom()+&quot;)&quot;;}</span>
<span class="nc" id="L94">        s[i]=t[i]+&quot; : &quot;+cTemp.getNourriture()+&quot;/&quot;+cTemp.getNourritureMax()+&quot; &quot;+g.get(&quot;nourriture&quot;)+sTemp;</span>
      }
      int id2;
<span class="nc bnc" id="L97" title="All 2 branches missed.">      if(t.length==1){</span>
<span class="nc" id="L98">        id2=t[0];</span>
      }else{
<span class="nc" id="L100">        BoiteListeDefilante bld = new BoiteListeDefilante();</span>
<span class="nc" id="L101">        id2 = bld.getChoixId(s,g.get(&quot;pti.desc.1&quot;));</span>
<span class="nc bnc" id="L102" title="All 2 branches missed.">        if(id2==-1){</span>
<span class="nc" id="L103">          erreur.erreur(&quot;Impossible de trophallaxer&quot;);</span>
<span class="nc" id="L104">          return;</span>
        }
      }
      //quantité de nourriture échangé.
<span class="nc" id="L108">      Creature c2 = f.getCCase().getContenu().getGc().getCreatureParId(id2);</span>
<span class="nc" id="L109">      int nour = math.min(c2.getNourritureMax()-c2.getNourriture(),f.getNourriture());</span>
<span class="nc bnc" id="L110" title="All 2 branches missed.">      if(nour&lt;1){erreur.alerte(&quot;Impossible de donner 0 nourriture&quot;);return;}</span>
<span class="nc" id="L111">      t = new int [nour];</span>
<span class="nc bnc" id="L112" title="All 2 branches missed.">      for (int i=0;i&lt;nour ;i++ ) {</span>
<span class="nc" id="L113">        t[i]=i+1;</span>
      }
<span class="nc" id="L115">      BoiteListeDefilante bld = new BoiteListeDefilante();</span>
<span class="nc" id="L116">      int n = bld.getChoixId(t,g.get(&quot;pti.desc.2&quot;));</span>
<span class="nc" id="L117">      trophallaxie(c,c2,n);</span>
    }
<span class="nc" id="L119">  }</span>
  /**
   *{@summary find hungry ant.}&lt;br&gt;
   *@param t The id list of the ant.
   *@param net The creature who whant to give food.
   *@version 1.7
   */
  public int [] getCreatureQuiOnFaim(int t[],Creature net){
<span class="pc bpc" id="L127" title="1 of 2 branches missed.">    if(!(net instanceof Fourmi)){erreur.alerte(&quot;Impossible de trophallaxer depuis une créature qui n'est pas une Fourmi&quot;);return new int[0];}</span>
<span class="fc" id="L128">    Fourmi f = (Fourmi)net;</span>
<span class="fc" id="L129">    GCreature gc = f.getAlliéSurLaCaseSansThis();</span>
<span class="fc" id="L130">    int lent = t.length;</span>
<span class="fc" id="L131">    int lentr = 0;</span>
    //on compte le nombre de fourmi a nourrir.
<span class="fc bfc" id="L133" title="All 2 branches covered.">    for (int i=0;i&lt;lent ;i++ ) {</span>
<span class="fc" id="L134">      Creature c = gc.getCreatureParId(t[i]);</span>
<span class="pc bpc" id="L135" title="1 of 4 branches missed.">      if(c!=null &amp;&amp; c.getNourriture()!=c.getNourritureMax()){</span>
<span class="fc" id="L136">        lentr++;</span>
      }
    }
    //on ajoute seuelement les fourmis qui on faim.
<span class="fc" id="L140">    int tr[] = new int[lentr];int k=0;</span>
<span class="fc bfc" id="L141" title="All 2 branches covered.">    for (int i=0;i&lt;lent ;i++ ) {</span>
<span class="fc" id="L142">      Creature c = gc.getCreatureParId(t[i]);</span>
<span class="pc bpc" id="L143" title="1 of 4 branches missed.">      if(c!=null &amp;&amp; c.getNourriture()!=c.getNourritureMax()){</span>
<span class="fc" id="L144">        tr[k] = t[i];k++;</span>
      }
    }
<span class="fc" id="L147">    return tr;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>