<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PanneauNouvellePartie.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Formiko</a> &gt; <a href="index.source.html" class="el_package">fr.formiko.views.gui2d</a> &gt; <span class="el_source">PanneauNouvellePartie.java</span></div><h1>PanneauNouvellePartie.java</h1><pre class="source lang-java linenums">package fr.formiko.views.gui2d;

import fr.formiko.formiko.Carte;
import fr.formiko.formiko.Main;
import fr.formiko.formiko.Partie;
import fr.formiko.usuel.debug;
import fr.formiko.usuel.erreur;
import fr.formiko.usuel.g;
import fr.formiko.usuel.listes.GString;
import fr.formiko.usuel.maths.math;
import fr.formiko.usuel.types.str;

import java.awt.Color;
import java.awt.Font;
import java.awt.Graphics;
import java.io.File;
import java.text.NumberFormat;
import javax.swing.JCheckBox;
import javax.swing.JComboBox;
import javax.swing.JFormattedTextField;

public class PanneauNouvellePartie extends PanneauLanceurPartie {
  private Desc jl; private Desc jl2;
  private GEtiquetteJoueur gej;
  private PanneauGEtiquetteJoueur pgej;
  private JFormattedTextField jtf;
  private Desc jtfDesc;
  private JComboBox&lt;String&gt; choixCarte;
  private Desc choixCarteDesc;
  private JCheckBox casesNuageuses;
  private JCheckBox casesSombres;
  private int taille;
  private GString gsClé;
  private EtiquetteChoix eDif;
  private EtiquetteChoix eVitesseDeJeu;
  // CONSTRUCTEUR ---------------------------------------------------------------
  public PanneauNouvellePartie(){
<span class="nc" id="L38">    super(100);</span>
<span class="nc" id="L39">    Main.startCh();</span>
<span class="nc" id="L40">    this.setLayout(null);</span>
    //setOpaque(false);
    //les entêtes.
<span class="nc" id="L43">    jl = new Desc(); jl2 = new Desc();</span>
<span class="nc" id="L44">    jl.setTexte(g.getM(&quot;paramètreCarte&quot;));</span>
<span class="nc" id="L45">    jl2.setTexte(g.getM(&quot;paramètreJeu&quot;));</span>
<span class="nc" id="L46">    jl.setFondTransparent();jl2.setFondTransparent();</span>
<span class="nc" id="L47">    jtfDesc = new Desc();</span>
<span class="nc" id="L48">    jtfDesc.setTexte(g.getM(&quot;nbrDeTour&quot;)+&quot; : &quot;);</span>
<span class="nc" id="L49">    jtfDesc.setFondTransparent();</span>
<span class="nc" id="L50">    choixCarteDesc = new Desc();</span>
<span class="nc" id="L51">    choixCarteDesc.setTexte(g.getM(&quot;choixCarte&quot;)+&quot; : &quot;);</span>
<span class="nc" id="L52">    choixCarteDesc.setFondTransparent();</span>
<span class="nc" id="L53">    this.add(jl);this.add(jl2);this.add(jtfDesc);this.add(choixCarteDesc);</span>
    //a gauche :
    //nom de la carte parmi ceux proposer.
<span class="nc" id="L56">    GString nomDesCartes = listeDesMap();//on charge les clé dans gsClé en meme temps.</span>
<span class="nc" id="L57">    choixCarte = nomDesCartes.getComboBox();</span>
<span class="nc" id="L58">    choixCarte.setFont(Main.getFont1(0.9));</span>
<span class="nc" id="L59">    choixCarte.setSelectedItem(g.get(&quot;miniWorld&quot;)); // 2 = miniWorld pour l'instant</span>
<span class="nc" id="L60">    add(choixCarte);</span>
    //nomCarte = nomDesCartes.getDébut().getContenu();
<span class="nc" id="L62">    GString gs = new GString();</span>
<span class="nc bnc" id="L63" title="All 2 branches missed.">    for (int i=-2; i&lt;4; i++){ // tout les niveaux de difficulté.</span>
<span class="nc" id="L64">      gs.add(g.getM(&quot;diff&quot;+i));</span>
    }
<span class="nc" id="L66">    eDif = new EtiquetteChoix(2,&quot;choixDif&quot;,gs);</span>
<span class="nc" id="L67">    add(eDif);</span>
<span class="nc" id="L68">    gs = new GString();</span>
<span class="nc bnc" id="L69" title="All 2 branches missed.">    for (int i=-3; i&lt;5; i++){ // tout les niveaux de vitesse.</span>
<span class="nc" id="L70">      gs.add(g.getM(&quot;vitesseDeJeu&quot;+i));</span>
    }
<span class="nc" id="L72">    eVitesseDeJeu = new EtiquetteChoix(3,&quot;choixVitesseDeJeu&quot;,gs);</span>
<span class="nc" id="L73">    add(eVitesseDeJeu);</span>
    //a droite :
<span class="nc" id="L75">    gej = new GEtiquetteJoueur(3);</span>

<span class="nc" id="L77">    pgej = new PanneauGEtiquetteJoueur(gej);</span>
<span class="nc" id="L78">    add(pgej);</span>
<span class="nc" id="L79">    jtf = new JFormattedTextField(NumberFormat.getIntegerInstance());</span>
<span class="nc" id="L80">    jtf.setText(&quot;100&quot;);</span>
<span class="nc" id="L81">    jtf.setFont(Main.getFont1(0.9));</span>
<span class="nc" id="L82">    add(jtf);</span>
<span class="nc" id="L83">    casesNuageuses = new JCheckBox();</span>
<span class="nc" id="L84">    casesSombres = new JCheckBox();</span>
<span class="nc" id="L85">    casesNuageuses.setFont(Main.getFont1());</span>
<span class="nc" id="L86">    casesSombres.setFont(Main.getFont1());</span>
<span class="nc" id="L87">    casesNuageuses.setText(g.getM(&quot;casesNuageuses&quot;));</span>
<span class="nc" id="L88">    casesSombres.setText(g.getM(&quot;casesSombres&quot;));</span>
<span class="nc" id="L89">    casesNuageuses.setBackground(new Color(0,0,0,0));</span>
<span class="nc" id="L90">    casesSombres.setBackground(new Color(0,0,0,0));</span>
<span class="nc" id="L91">    casesNuageuses.setSelected(true);</span>
<span class="nc" id="L92">    casesSombres.setSelected(true);</span>
<span class="nc" id="L93">    add(casesNuageuses);add(casesSombres);</span>
<span class="nc" id="L94">    Main.endCh(&quot;chargementPanneauNouvellePartie&quot;);</span>
<span class="nc" id="L95">  }</span>
  public void rafraichirPgej(){
<span class="nc" id="L97">    remove(pgej);</span>
<span class="nc" id="L98">    pgej = new PanneauGEtiquetteJoueur(gej);</span>
<span class="nc" id="L99">    add(pgej);</span>
<span class="nc" id="L100">    repaint();</span>
<span class="nc" id="L101">  }</span>
  // GET SET --------------------------------------------------------------------
<span class="nc" id="L103">  public GEtiquetteJoueur getGej(){ return gej;}</span>
<span class="nc" id="L104">  public int getTaille(){ return taille;}</span>
<span class="nc" id="L105">  public PanneauGEtiquetteJoueur getPGej(){ return pgej;}</span>
  // Fonctions propre -----------------------------------------------------------
  public void paintComponent(Graphics g){
<span class="nc" id="L108">    int wi = Main.getDimX();</span>
<span class="nc" id="L109">    int he = Main.getDimY();</span>
<span class="nc" id="L110">    int wi2 = wi/2;</span>
    //gauche
<span class="nc" id="L112">    jl.setBounds(0,0,wi2);</span>
<span class="nc" id="L113">    int k=1; taille = jl.getHeight()*2;</span>
<span class="nc" id="L114">    jtfDesc.setBounds(0,taille*k,wi2/2,Desc.getDimY());</span>
<span class="nc" id="L115">    jtf.setBounds(wi2/2,taille*k,wi2/3,Desc.getDimY());k++;</span>
<span class="nc" id="L116">    choixCarteDesc.setBounds(0,taille*k,wi2/2,Desc.getDimY());</span>
<span class="nc" id="L117">    choixCarte.setBounds(wi2/2,taille*k,wi2/3,Desc.getDimY());k++;</span>
<span class="nc" id="L118">    eDif.setBounds(0,taille*k,1000,Desc.getDimY());k++;</span>
<span class="nc" id="L119">    eVitesseDeJeu.setBounds(0,taille*k,1000,Desc.getDimY());k++;</span>
<span class="nc" id="L120">    casesNuageuses.setBounds(0,taille*k,wi2/2,Desc.getDimY());</span>
<span class="nc" id="L121">    casesSombres.setBounds(wi2/2,taille*k,wi2/3,Desc.getDimY());k++;</span>
    //droite
<span class="nc" id="L123">    int yDep=0;</span>
<span class="nc" id="L124">    jl2.setBounds(wi2,yDep,wi2); yDep=yDep+jl2.getHeight()*2;</span>
<span class="nc" id="L125">    int tailleMaxY = this.getHeight() - yDep;</span>
<span class="nc" id="L126">    pgej.setBounds(wi2,yDep,wi2,math.max(Desc.getDimY()*3*gej.length(),tailleMaxY));</span>
<span class="nc" id="L127">  }</span>
  public Partie getPartie(){
<span class="nc" id="L129">    String nomTraduitDeLaCarte = choixCarte.getSelectedItem()+&quot;&quot;;</span>
<span class="nc" id="L130">    String nomDeLaCarte = gsClé.getKey(nomTraduitDeLaCarte);</span>
<span class="nc" id="L131">    Carte mapo = new Carte(nomDeLaCarte);</span>
<span class="nc" id="L132">    mapo.setCasesNuageuses(casesNuageuses.isSelected());</span>
<span class="nc" id="L133">    mapo.setCasesSombres(casesSombres.isSelected());</span>
<span class="nc" id="L134">    int dif = calculeDif();</span>
<span class="nc" id="L135">    Double vitesseDeJeu = calculeVitesseDeJeu();</span>
    // On transmet la difficulté, le nombre de tour, la carte et la vitesse de jeu.
<span class="nc" id="L137">    Partie pa = new Partie(dif,str.sToI(jtf.getText()),mapo,vitesseDeJeu);</span>
<span class="nc" id="L138">    pa.setElément(1,1,1); // ne sert pas en pratique.</span>
<span class="nc" id="L139">    pa.setGej(gej); // permet de passer toutes les informations des joueurs et ia a la partie.</span>
<span class="nc" id="L140">    return pa;</span>
  }
  public GString listeDesMap(){
<span class="nc" id="L143">    String chemin = Main.getFolder().getFolderStable()+Main.getFolder().getFolderMaps();</span>
<span class="nc" id="L144">    File docier = new File(chemin);</span>
<span class="nc" id="L145">    File[] fichiers = docier.listFiles();</span>
<span class="nc" id="L146">    GString gsr = new GString();</span>
<span class="nc" id="L147">    gsClé = new GString();</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">    for (File f : fichiers ) {</span>
<span class="nc" id="L149">      String s = f+&quot;&quot;;</span>
<span class="nc" id="L150">      int lens = s.length();</span>
<span class="nc bnc" id="L151" title="All 4 branches missed.">      if(str.nbrDeX(s,'~')==0 &amp;&amp; s.substring(lens-4).equals(&quot;.csv&quot;)){</span>
<span class="nc" id="L152">        String t [] = s.split(&quot;/&quot;);</span>
<span class="nc" id="L153">        s=t[t.length-1];</span>
<span class="nc" id="L154">        lens = s.length();</span>
<span class="nc" id="L155">        s=s.substring(0,lens-4);</span>
<span class="nc" id="L156">        gsr.add(g.get(s));</span>
<span class="nc" id="L157">        gsClé.add(s);</span>
      }
    }
<span class="nc" id="L160">    return gsr;</span>
  }

  public double calculeVitesseDeJeu(){
    // l'objetif est de récupéré la vitesse de jeu dans une liste déroulante sous la forme d'1 String et d'aboutir a un double qu'on puisse utiliser pour ralentir ou accélérer le jeu.
<span class="nc" id="L165">    String vitesse = eVitesseDeJeu.getSelectedItem(); // on récupère la String</span>
<span class="nc" id="L166">    int x=0; boolean b=false;</span>
<span class="nc" id="L167">    int i=-3;</span>
<span class="nc bnc" id="L168" title="All 4 branches missed.">    while(i&lt;5 &amp;&amp; !b){</span>
<span class="nc bnc" id="L169" title="All 2 branches missed.">      if (vitesse.equals(g.getM(&quot;vitesseDeJeu&quot;+i))){ // on  la compare avec toutes les valeurs qu'elle peut avoir dans la langue du jeu.</span>
<span class="nc" id="L170">        x=i+3;b=true;//si on trouve la String b = true</span>
<span class="nc" id="L171">      }i++;</span>
    }//si b n'est pas true, on a une erreur.
<span class="nc bnc" id="L173" title="All 2 branches missed.">    if (!b){ erreur.erreur(&quot;La vitesse de jeu n'as pas pue être reconnue au lancement de la partie&quot;,&quot;vitesse déffinie a 1 (normale)&quot;);}</span>
<span class="nc" id="L174">    Double tv [] = {0.25,0.5,0.75,1.0,1.5,2.0,2.75,4.0}; //du plus rapide au plus lent</span>
    Double vitesseDeJeu;
    try { // on cherche dans le tableau la case numéro x.
<span class="nc" id="L177">      vitesseDeJeu = tv[x];</span>
<span class="nc" id="L178">    }catch (Exception e) { // au cas ou cette case n'existe pas on prévoi un message d'erreur.</span>
<span class="nc" id="L179">      erreur.erreur(&quot;La difficulté n'est pas correcte&quot;,&quot;difficulté fixé a la valeur min ou max.&quot;);</span>
<span class="nc bnc" id="L180" title="All 2 branches missed.">      if(x&lt;1){vitesseDeJeu = tv[0];}</span>
<span class="nc" id="L181">      else{vitesseDeJeu = tv[tv.length-1];}</span>
<span class="nc" id="L182">    }//on return la vitesse de jeu.</span>
<span class="nc" id="L183">    return vitesseDeJeu;</span>
  }
  public int calculeDif(){
<span class="nc" id="L186">    String s = eDif.getSelectedItem();</span>
<span class="nc" id="L187">    int dif=0; boolean b=false;</span>
<span class="nc bnc" id="L188" title="All 2 branches missed.">    for (int i=-2; i&lt;4; i++){ // tout les niveau de difficulté.</span>
<span class="nc bnc" id="L189" title="All 2 branches missed.">      if (s.equals(g.getM(&quot;diff&quot;+i))){</span>
<span class="nc" id="L190">        dif = i;b=true;break;</span>
      }
    }
<span class="nc bnc" id="L193" title="All 2 branches missed.">    if (!b){ erreur.erreur(&quot;La difficulté n'as pas pue être reconnue au lancement de la partie&quot;,&quot;difficulté déffinie a 0 (normale)&quot;);}</span>
<span class="nc" id="L194">    return dif;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>