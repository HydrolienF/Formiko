<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Data.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Formiko</a> &gt; <a href="index.source.html" class="el_package">fr.formiko.views.gui2d</a> &gt; <span class="el_source">Data.java</span></div><h1>Data.java</h1><pre class="source lang-java linenums">package fr.formiko.views.gui2d;

import fr.formiko.formiko.Case;
import fr.formiko.formiko.Main;
import fr.formiko.usuel.debug;
import fr.formiko.usuel.erreur;
import fr.formiko.usuel.g;
import fr.formiko.usuel.images.Img;
import fr.formiko.usuel.images.Pixel;
import fr.formiko.usuel.images.image;
import fr.formiko.usuel.maths.allea;
import fr.formiko.usuel.maths.math;
import fr.formiko.usuel.types.str;

import java.awt.Image;
import java.awt.image.BufferedImage;

/**
*{@summary Contain all data (images) that will be used by the graphic interface.}
*@author Hydrolien
*@version 1.18
*/
<span class="fc" id="L23">public class Data {</span>
  private int tailleDUneCase; // entre 10 et 500.
  //private final int tailleDUneCaseBase = 500;
  //private int scale = Image.SCALE_SMOOTH;
  private boolean imageIni;
  private boolean imageIniForNewGame;
  //image
  private BufferedImage imgNull;
  private BufferedImage selectionnee; private BufferedImage fere;
  private BufferedImage cNuageuse,cSombre;
  private BufferedImage b[];
  private BufferedImage tICarte[];
  private BufferedImage tIF[][];
  private BufferedImage tII[][];
  private BufferedImage tG[][];
  private BufferedImage tF[][];
  private BufferedImage map;
  //ini (this var sould not be modify in an other place than here.)
  private BufferedImage imgNullIni;
  private BufferedImage selectionneeIni; private BufferedImage fereIni;
  private BufferedImage cNuageuseIni,cSombreIni;
  private BufferedImage bIni[];
  private BufferedImage tICarteIni[];
  private BufferedImage tIFIni[][];
  private BufferedImage tIIIni[][];
  private BufferedImage tGIni[][];
  private BufferedImage tFIni[][];
  //PanneauAction
  private BufferedImage tImage [];
  //PanneauZoom
  private Image [] tIBZoom;
  private boolean initialisationFX;
  //PanneauChargement
  private BufferedImage imageChargement;

  // CONSTRUCTEUR ---------------------------------------------------------------
  /**
  *Main constructor.
  *@version 1.18
  */
  public void Data(){
<span class="nc" id="L64">    initialisationFX=false;</span>
<span class="nc" id="L65">  }</span>
  // GET SET --------------------------------------------------------------------
  //ini
<span class="nc" id="L68">  public int getTailleDUneCase(){return tailleDUneCase;}</span>
<span class="nc" id="L69">  public void setTailleDUneCase(int x){tailleDUneCase=x;}</span>
<span class="nc" id="L70">  public BufferedImage getImgNull(){return imgNull;}</span>
<span class="nc" id="L71">  public BufferedImage getSelectionnee(){return selectionnee;}</span>
<span class="nc" id="L72">  public BufferedImage getFere(){return fere;}</span>
<span class="nc" id="L73">  public BufferedImage getCNuageuse(){return cNuageuse;}</span>
<span class="nc" id="L74">  public BufferedImage getCSombre(){return cSombre;}</span>
<span class="nc" id="L75">  public BufferedImage [] getB(){return b;}</span>
<span class="nc" id="L76">  public BufferedImage [] getTICarte(){return tICarte;}</span>
<span class="nc" id="L77">  public BufferedImage [][] getTIF(){return tIF;}</span>
<span class="nc" id="L78">  public BufferedImage [][] getTII(){return tII;}</span>
<span class="nc" id="L79">  public BufferedImage [][] getTG(){return tG;}</span>
<span class="nc" id="L80">  public BufferedImage [][] getTF(){return tF;}</span>
<span class="nc" id="L81">  public BufferedImage getMap(){return map;}</span>
  //PanneauAction
<span class="nc" id="L83">  public BufferedImage [] getTImage(){return tImage;}</span>
  //PanneauChargement
<span class="nc" id="L85">  public BufferedImage getImageChargement(){return imageChargement;}</span>
  //imageIni
<span class="nc" id="L87">  public void setImageIniForNewGame(boolean b){imageIniForNewGame=b;}</span>
  // Fonctions propre -----------------------------------------------------------

  //public class Controleur{
    //iniImage etc
    /**
    *{@summary Load image in map resolution.}&lt;br&gt;
    *If the original image have'nt been load, it will call chargerImagesIni.&lt;br&gt;
    *The images defined here have the rigth dimention for being used on the map.&lt;br&gt;
    *@version 1.18
    */
    public void chargerImages(){
<span class="nc" id="L99">      debug.débogage(&quot;chargement des images a la bonne taille.&quot;);</span>
<span class="nc" id="L100">      chargerImagesIni();</span>
<span class="nc" id="L101">      Main.startCh();</span>
<span class="nc" id="L102">      int tailleFourmi = (tailleDUneCase*4)/5;</span>
<span class="nc" id="L103">      imgNull = image.resize(imgNullIni,tailleDUneCase);</span>
<span class="nc" id="L104">      selectionnee = image.resize(selectionneeIni,tailleDUneCase);</span>
<span class="nc" id="L105">      tICarte=getScaledInstance(tICarteIni, tailleDUneCase);</span>
<span class="nc" id="L106">      tIF=getScaledInstance(tIFIni, tailleFourmi);</span>
<span class="nc" id="L107">      tII=getScaledInstance(tIIIni, tailleFourmi,2);//les insectes</span>
<span class="nc" id="L108">      tF=getScaledInstance(tFIni, tailleFourmi,1);//les Fourmis au différent stade.</span>
<span class="nc" id="L109">      tG=getScaledInstance(tGIni, tailleFourmi);</span>
<span class="nc" id="L110">      fere = image.resize(fereIni,tailleDUneCase/2);</span>
<span class="nc" id="L111">      cNuageuse = image.resize(cNuageuseIni,tailleDUneCase);</span>
<span class="nc" id="L112">      cSombre = image.resize(cSombreIni,tailleDUneCase);</span>
<span class="nc" id="L113">      int lenb = bIni.length;</span>
<span class="nc" id="L114">      b=getScaledInstance(bIni,tailleDUneCase/2);</span>
<span class="nc" id="L115">      Main.endCh(&quot;chargerImages&quot;);</span>
<span class="nc" id="L116">    }</span>
    /**
    *{@summary Load image in full resolution.}&lt;br&gt;
    *Image need to be load in full resolution 1 time only. If it have alredy be done the function will do nothing.
    *@version 1.33
    */
    public void chargerImagesIni(){
<span class="nc bnc" id="L123" title="All 2 branches missed.">      if(!imageIni){</span>
<span class="nc" id="L124">        Main.startCh();</span>
<span class="nc" id="L125">        imgNullIni = image.getImage(&quot;null&quot;);//.getScaledInstance(tailleDUneCaseBase, tailleDUneCaseBase,scale);</span>
<span class="nc" id="L126">        selectionneeIni = image.getImage(&quot;selectionnee&quot;);//.getScaledInstance(tailleDUneCaseBase, tailleDUneCaseBase,scale);</span>
<span class="nc" id="L127">        chargerTI();</span>
<span class="nc" id="L128">        tIIIni = chargerTX(&quot;I&quot;);</span>
<span class="nc" id="L129">        tFIni = chargerTX(&quot;fourmi&quot;,3);</span>
<span class="nc" id="L130">        tGIni = chargerTX(&quot;graine&quot;);</span>
<span class="nc" id="L131">        fereIni = image.getImage(&quot;fourmiliere&quot;);//.getScaledInstance(tailleDUneCaseBase/2, tailleDUneCaseBase/2,scale);</span>
<span class="nc" id="L132">        cNuageuseIni = image.getImage(&quot;cNuageuse&quot;);//.getScaledInstance(tailleDUneCaseBase, tailleDUneCaseBase,scale);</span>
<span class="nc" id="L133">        cSombreIni = image.getImage(&quot;cSombre&quot;);//.getScaledInstance(tailleDUneCaseBase, tailleDUneCaseBase,scale);</span>
<span class="nc" id="L134">        bIni = image.getImages(&quot;b&quot;); int lenb = bIni.length;</span>
        /*for (int i=0;i&lt;lenb ;i++ ) {
          bIni[i]=bIni[i].getScaledInstance(tailleDUneCaseBase/2, tailleDUneCaseBase/2,scale);
        }*/
<span class="nc" id="L138">        Main.endCh(&quot;chargerImagesIni&quot;);</span>
      }
<span class="nc" id="L140">      imageIni=true;</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">      if(!imageIniForNewGame){</span>
<span class="nc" id="L142">        tIFIni = chargerTX(&quot;F&quot;,Main.getNbrDeJoueur(),(byte)0,1);</span>
      }
<span class="nc" id="L144">      imageIniForNewGame=true;</span>
<span class="nc" id="L145">    }</span>
    /**
    *Load Case image
    *@version 1.18
    */
    public void chargerTI(){
<span class="nc" id="L151">      tICarteIni = new BufferedImage [3];</span>
<span class="nc" id="L152">      tICarteIni[0]=image.getImage(&quot;herbe&quot;);</span>
<span class="nc" id="L153">      tICarteIni[1]=image.getImage(&quot;mousse&quot;);</span>
<span class="nc" id="L154">      tICarteIni[2]=image.getImage(&quot;sable&quot;);</span>
<span class="nc" id="L155">    }</span>
    /**
    *{@summary Load a group of BufferedImage that starts with a similar name.}&lt;br&gt;
    *see image.getImagess() for more informations.
    @param nom Name of de group. Every image will start by this name.
    *@version 1.18
    */
    public BufferedImage [][] chargerTX(String nom, int x, byte y, int début){
<span class="nc" id="L163">      return image.getImagess(nom,x,(byte)début);</span>
    }
<span class="nc" id="L165">    public BufferedImage [][] chargerTX(String nom, int x, byte y){ return chargerTX(nom,x,y,0);}</span>
<span class="nc" id="L166">    public BufferedImage [][] chargerTX(String sn, int x){ return chargerTX(sn,x,(byte)0);}</span>
<span class="nc" id="L167">    public BufferedImage [][] chargerTX(String sn){return chargerTX(sn,image.getNbrImages(sn));}</span>

    /**
    *Create a background image from tI1 and tI2 images.
    *@version 1.42
    */
    public void iniBackgroundMapImage(){
<span class="nc bnc" id="L174" title="All 2 branches missed.">      if(!Main.getView().getActionGameOn()){return;}</span>
<span class="nc" id="L175">      Main.startCh();</span>
      // if(Main.getPc()==null){erreur.erreur(&quot;Map panel is null&quot;);}
<span class="nc" id="L177">      Main.getPc().actualiserSize();</span>
<span class="nc" id="L178">      Img img = new Img(Main.getPc().getWidth(),Main.getPc().getHeight());</span>
      //if(img.)
<span class="nc" id="L180">      Img img2 = null;</span>
<span class="nc" id="L181">      int xCase = Main.getPc().getXCase();</span>
<span class="nc" id="L182">      int yCase = Main.getPc().getYCase();</span>
      try {
        // if(getTailleDUneCase()&lt;1){erreur.erreur(&quot;Case size is &lt;1&quot;);}
<span class="nc bnc" id="L185" title="All 2 branches missed.">        for (int i=0;i&lt;xCase ;i++ ) {</span>
<span class="nc bnc" id="L186" title="All 2 branches missed.">          for (int j=0;j&lt;yCase ;j++ ) {</span>
<span class="nc" id="L187">            int xT = i*getTailleDUneCase(); int yT = j*getTailleDUneCase();</span>
<span class="nc" id="L188">            Case c=null;</span>
            try {
<span class="nc" id="L190">              c = Main.getGc().getCCase(i+Main.getPc().getPosX(),j+Main.getPc().getPosY()).getContenu();</span>
<span class="nc" id="L191">            }catch (Exception e) {erreur.erreur(&quot;case is null&quot;);}</span>
            try {
<span class="nc" id="L193">              img2 = new Img(tICarte[c.getType()-1]);</span>
<span class="nc" id="L194">            }catch (Exception e) {</span>
<span class="nc" id="L195">              img2 = new Img(imgNull);</span>
<span class="nc" id="L196">              erreur.alerte(&quot;A map image can't be load&quot;);</span>
<span class="nc" id="L197">            }</span>
            try {
<span class="nc" id="L199">              img.add(xT,yT,img2);</span>
<span class="nc" id="L200">            }catch (Exception e) {</span>
<span class="nc" id="L201">              erreur.erreur(&quot;img.add() fail&quot;);</span>
<span class="nc" id="L202">            }</span>
          }
        }
        try {
<span class="nc" id="L206">          img.actualiserImage();</span>
<span class="nc" id="L207">          map = img.getBi();</span>
<span class="nc" id="L208">        }catch (Exception e) {</span>
<span class="nc" id="L209">          erreur.erreur(&quot;Map image can't be update&quot;);</span>
<span class="nc" id="L210">          map=null;</span>
<span class="nc" id="L211">        }</span>
<span class="nc" id="L212">      }catch (Exception e) {</span>
<span class="nc" id="L213">        erreur.erreur(&quot;iniBackgroundMapImage fail&quot;);</span>
<span class="nc" id="L214">        map=null;</span>
<span class="nc" id="L215">      }</span>
<span class="nc" id="L216">      Main.endCh(&quot;iniBackgroundMapImage&quot;);</span>
<span class="nc" id="L217">    }</span>

    //getScaledInstance.
    /**
    *Return a scaled BufferedImage []
    *@version 1.18
    */
    public BufferedImage [] getScaledInstance(BufferedImage ti[],int dim, int b){
<span class="nc" id="L225">      int lenr = ti.length;</span>
<span class="nc" id="L226">      BufferedImage r [] = new BufferedImage[lenr];</span>
<span class="nc bnc" id="L227" title="All 2 branches missed.">      for (int i=0;i&lt;lenr ;i++ ) {</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">        if(b==0){//par défaut</span>
<span class="nc" id="L229">          r[i]=image.resize(ti[i],dim);</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">        }else if(b==1){//pour les fourmis.</span>
<span class="nc" id="L231">          int idEspece = 0;</span>
<span class="nc" id="L232">          int stade = i-3;</span>
<span class="nc" id="L233">          r[i]=image.resize(ti[i],image.taille(idEspece, stade,dim));</span>
<span class="nc bnc" id="L234" title="All 2 branches missed.">        }else if(b==2){//pour les insectes</span>
<span class="nc" id="L235">          int idEspece = i+100;</span>
<span class="nc" id="L236">          int stade = 0;</span>
<span class="nc" id="L237">          r[i]=image.resize(ti[i],image.taille(idEspece, stade,dim));</span>
        }
      }
<span class="nc" id="L240">      return r;</span>
<span class="nc" id="L241">    }public BufferedImage [] getScaledInstance(BufferedImage ti[],int dim){return getScaledInstance(ti,dim,0);}</span>
    /**
    *Return a scaled BufferedImage [][]
    *@version 1.18
    */
    public BufferedImage [][] getScaledInstance(BufferedImage ti[][],int dim, int b){
<span class="nc" id="L247">      int lenr = ti.length;</span>
<span class="nc" id="L248">      BufferedImage r [][] = new BufferedImage[lenr][];</span>
<span class="nc bnc" id="L249" title="All 2 branches missed.">      for (int i=0;i&lt;lenr ;i++ ) {</span>
<span class="nc" id="L250">        r[i]=getScaledInstance(ti[i],dim,b);</span>
      }
<span class="nc" id="L252">      return r;</span>
<span class="nc" id="L253">    }public BufferedImage [][] getScaledInstance(BufferedImage ti[][],int dim){return getScaledInstance(ti,dim,0);}</span>

  //}
  //PanneauAction
  /**
  *Load graphics for PanneauAction
  *@version 1.18
  */
  public synchronized void chargerTIPanneauAction(){
<span class="nc bnc" id="L262" title="All 2 branches missed.">    if (tImage==null){</span>
<span class="nc bnc" id="L263" title="All 2 branches missed.">      if(Main.getPiFond()!=null){</span>
<span class="nc" id="L264">        chargerTImageAvecFond(Main.getPiFond());</span>
      }else{
<span class="nc" id="L266">        chargerTImage();</span>
      }
<span class="nc" id="L268">      PanneauActionInf.chargerFond();</span>
<span class="nc" id="L269">      PanneauActionSup.chargerFond();</span>
    }
<span class="nc" id="L271">  }</span>
  /**
  *Load images for PanneauAction without background
  *@version 1.18
  */
  public void chargerTImage(){
<span class="nc" id="L277">    int tailleBouton = Main.getPa().getTailleBouton();</span>
<span class="nc" id="L278">    tImage = image.getImages(&quot;desc&quot;);</span>
<span class="nc bnc" id="L279" title="All 2 branches missed.">    for (int i=0;i&lt;10 ;i++ ) {</span>
<span class="nc" id="L280">      tImage[i] = image.resize(tImage[i],tailleBouton);</span>
    }
<span class="nc" id="L282">  }</span>
  /**
  *Load images for PanneauAction with background
  *@version 1.18
  */
  public void chargerTImageAvecFond(Pixel pi){
<span class="nc" id="L288">    int tailleBouton = Main.getPa().getTailleBouton();</span>
<span class="nc bnc" id="L289" title="All 2 branches missed.">    for (int k=0;k&lt;10 ;k++) {</span>
<span class="nc" id="L290">      Img img = new Img(&quot;desc&quot;+k);</span>
<span class="nc" id="L291">      img.changerPixelTransparent(pi);</span>
<span class="nc" id="L292">      img.sauvegarder(&quot;temporaire/desc&quot;+k+&quot;.png&quot;);</span>
    }
<span class="nc" id="L294">    tImage = image.getImages(&quot;temporaire/desc&quot;);</span>
<span class="nc bnc" id="L295" title="All 2 branches missed.">    for (int i=0;i&lt;10 ;i++ ) {</span>
<span class="nc" id="L296">      tImage[i] = image.resize(tImage[i],tailleBouton);</span>
    }
<span class="nc" id="L298">  }</span>
  //PanneauZoom
  /**
  *Load images for PanneauZoom
  *@version 1.18
  */
  public Image [] chargerTIBZoom(){
<span class="nc" id="L305">    tIBZoom = new Image[9];</span>
<span class="nc bnc" id="L306" title="All 4 branches missed.">    if(!initialisationFX &amp;&amp; !Main.getGarderLesGraphismesTourné()){tournerLesFleches();}</span>
<span class="nc" id="L307">    int tailleBouton=Main.getbuttonSizeZoom();</span>
<span class="nc" id="L308">    tIBZoom[0] = image.getImage(&quot;moins&quot;).getScaledInstance(tailleBouton,tailleBouton ,Image.SCALE_SMOOTH);</span>
<span class="nc" id="L309">    tIBZoom[1] = image.getImage(&quot;fleche&quot;).getScaledInstance(tailleBouton,tailleBouton ,Image.SCALE_SMOOTH);</span>
<span class="nc" id="L310">    tIBZoom[2] = image.getImage(&quot;plus&quot;).getScaledInstance(tailleBouton,tailleBouton ,Image.SCALE_SMOOTH);</span>
<span class="nc" id="L311">    tIBZoom[3] = image.getImage(&quot;fleche1&quot;).getScaledInstance(tailleBouton,tailleBouton ,Image.SCALE_SMOOTH);</span>
    //tourner +90°
<span class="nc" id="L313">    tIBZoom[4] = image.getImage(&quot;centrer&quot;).getScaledInstance(tailleBouton,tailleBouton ,Image.SCALE_SMOOTH);</span>
<span class="nc" id="L314">    tIBZoom[5] = image.getImage(&quot;fleche2&quot;).getScaledInstance(tailleBouton,tailleBouton ,Image.SCALE_SMOOTH);</span>
    //tourner -90°
<span class="nc" id="L316">    tIBZoom[6] = image.getImage(&quot;fleche3&quot;).getScaledInstance(tailleBouton,tailleBouton ,Image.SCALE_SMOOTH);</span>
    //tourner +180°
<span class="nc" id="L318">    tIBZoom[7] = image.getImage(&quot;centrer&quot;).getScaledInstance(tailleBouton,tailleBouton ,Image.SCALE_SMOOTH);</span>
<span class="nc" id="L319">    tIBZoom[8] = image.getImage(&quot;centrer&quot;).getScaledInstance(tailleBouton,tailleBouton ,Image.SCALE_SMOOTH);</span>
<span class="nc" id="L320">    return tIBZoom;</span>
  }
  /**
  *Turn the arrow for PanneauZoom
  *@version 1.18
  */
  public void tournerLesFleches(String nom){
<span class="nc" id="L327">    initialisationFX=true;</span>
<span class="nc" id="L328">    Img f = new Img(nom);</span>
<span class="nc" id="L329">    Img f1 = f.clone();</span>
<span class="nc" id="L330">    f1.tourner(1);</span>
<span class="nc" id="L331">    Img f2 = f.clone();</span>
<span class="nc" id="L332">    f2.tourner(3);</span>
<span class="nc" id="L333">    Img f3 = f.clone();</span>
<span class="nc" id="L334">    f3.tourner(2);</span>
<span class="nc" id="L335">    f2.sauvegarder(&quot;fleche2.png&quot;);</span>
<span class="nc" id="L336">    f1.sauvegarder(&quot;fleche1.png&quot;);</span>
<span class="nc" id="L337">    f3.sauvegarder(&quot;fleche3.png&quot;);</span>
<span class="nc" id="L338">  }public void tournerLesFleches(){ tournerLesFleches(&quot;fleche&quot;);}</span>

  /**
  *{@summary Loard a loading image for PanneauChargement.}
  *@version 1.32
  */
  public boolean loadImageChargement(){
<span class="nc" id="L345">    String mapName = Main.getMap().getMapName();</span>
<span class="nc" id="L346">    mapName = str.sToSMaj(mapName);</span>
<span class="nc" id="L347">    imageChargement=null;</span>
<span class="nc bnc" id="L348" title="All 4 branches missed.">    if(mapName!=null &amp;&amp; !mapName.equals(&quot;&quot;)){</span>
<span class="nc" id="L349">      imageChargement=image.getImage(&quot;chargement&quot;+mapName,false);</span>
<span class="nc bnc" id="L350" title="All 2 branches missed.">      if(imageChargement!=null){</span>
<span class="nc" id="L351">        imageChargement=image.resize(imageChargement,Main.getDimX(),Main.getDimY());</span>
      }
    }
    //if it haven't been load yet we try to load any image name chargementi.png or .jpj.
<span class="nc bnc" id="L355" title="All 2 branches missed.">    if(imageChargement==null){</span>
<span class="nc" id="L356">      int x = allea.getAlléa(image.getNbrImages(&quot;chargement&quot;));</span>
<span class="nc" id="L357">      imageChargement=image.getImage(&quot;chargement&quot;+x);</span>
<span class="nc" id="L358">      imageChargement=image.resize(imageChargement,Main.getDimX(),Main.getDimY());</span>
<span class="nc" id="L359">      return true;</span>
    }
<span class="nc" id="L361">    return false;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>