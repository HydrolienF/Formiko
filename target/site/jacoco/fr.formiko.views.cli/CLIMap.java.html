<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CLIMap.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Formiko</a> &gt; <a href="index.source.html" class="el_package">fr.formiko.views.cli</a> &gt; <span class="el_source">CLIMap.java</span></div><h1>CLIMap.java</h1><pre class="source lang-java linenums">package fr.formiko.views.cli;

import fr.formiko.formiko.CCase;
import fr.formiko.formiko.Case;
import fr.formiko.formiko.Creature;
import fr.formiko.formiko.Fourmi;
import fr.formiko.formiko.Fourmiliere;
import fr.formiko.formiko.GCase;
import fr.formiko.formiko.Graine;
import fr.formiko.formiko.Insecte;
import fr.formiko.formiko.Joueur;
import fr.formiko.formiko.Main;
import fr.formiko.formiko.ObjetSurCarteAId;
import fr.formiko.usuel.ascii;
import fr.formiko.usuel.color;
import fr.formiko.usuel.erreur;
import fr.formiko.usuel.g;
import fr.formiko.usuel.listes.GString;

/**
*{@summary Represent the Map in CLI mode.}&lt;br&gt;
*CLI = Console Line Interface.
*@version 1.39
*@author Hydrolien
*/
public class CLIMap{
  private GCase gc;
  private static GString legend; private static int xi;
  private static int unseeableChar;
<span class="fc" id="L30">  private int sizeCase = 4;</span>
  private Case lookedCase;
  // CONSTRUCTORS --------------------------------------------------------------
  /**
  *{@summary Main contructor.}&lt;br&gt;
  *@param gc The GCase to print.&lt;br&gt;
  *@version 1.38
  */
<span class="fc" id="L38">  public CLIMap(GCase gc){</span>
<span class="fc" id="L39">    this.gc=gc;</span>
<span class="fc" id="L40">  }</span>
  // GET SET -------------------------------------------------------------------
<span class="nc" id="L42">  public Case getLookedCase(){return lookedCase;}</span>
<span class="nc" id="L43">  public void setLookedCase(Case c){lookedCase=c;}</span>
  // FUNCTIONS -----------------------------------------------------------------
  /**
  *{@summary Main function of CLIMap.}&lt;br&gt;
  *If on linux it will use color for the map.
  *@return Printable String that represent GString.&lt;br&gt;
  *@version 1.38
  */
  public String toString(){
<span class="nc" id="L52">    String sr = &quot;&quot;;</span>
<span class="nc bnc" id="L53" title="All 4 branches missed.">    if(gc==null || gc.getDébut()==null){</span>
<span class="nc" id="L54">      erreur.erreur(&quot;La carte est vide&quot;);</span>
    }else{
<span class="nc" id="L56">      xi = 0; legend = new GString();</span>
<span class="nc" id="L57">      sr+=mapToMapString();</span>
<span class="nc" id="L58">      sr+=legendToString();</span>
<span class="nc bnc" id="L59" title="All 2 branches missed.">      if(getLookedCase()!=null){</span>
<span class="nc" id="L60">        sr+=&quot;\n&quot;+g.getM(&quot;lookedCase&quot;)+&quot; : &quot;+getLookedCase().toString();</span>
      }
    }
<span class="nc" id="L63">    return sr;</span>
  }
  //private
  /**
  *{@summary Return a color String to represent the ally status of Creature c with the playingAnt.}
  *@version 1.38
  */
  private static String getColorAllyStatus(Creature c){
<span class="fc" id="L71">    Fourmi f = Main.getPlayingAnt();</span>
<span class="pc bpc" id="L72" title="1 of 2 branches missed.">    if(f==null){return &quot;&quot;;}</span>
<span class="fc" id="L73">    String r=&quot;&quot;;</span>
<span class="fc bfc" id="L74" title="All 2 branches covered.">    if(c.equals(f)){</span>
<span class="fc" id="L75">      r = color.GREEN_FLASH;unseeableChar+=color.GREEN_FLASH.length();</span>
<span class="fc bfc" id="L76" title="All 2 branches covered.">    }else if(c.getEstEnnemi(f)){</span>
<span class="fc" id="L77">      r = color.RED;unseeableChar+=color.RED.length();</span>
<span class="pc bpc" id="L78" title="1 of 2 branches missed.">    }else if(c.getEstAllié(f)){</span>
<span class="fc" id="L79">      r = color.GREEN;unseeableChar+=color.GREEN.length();</span>
    }else{
<span class="nc" id="L81">      r = color.YELLOW;unseeableChar+=color.YELLOW.length();</span>
    }
<span class="fc" id="L83">    return r;</span>
  }
  /**
  *{@summary Return a String representing the ObjetSurCarteAId in param.}
  *@param o The Object to represent.
  *@version 1.38
  */
  //public only for test
  public static String objetSurCarteAIdToString(ObjetSurCarteAId o){
<span class="fc" id="L92">    String s=&quot;&quot;;</span>
<span class="fc" id="L93">    boolean b = Main.getOs().isLinux();</span>
<span class="fc bfc" id="L94" title="All 2 branches covered.">    if(o instanceof Insecte){</span>
<span class="fc bfc" id="L95" title="All 4 branches covered.">      if(b){s+=getColorAllyStatus((Creature)o);} s+=&quot;I&quot;; s+=o.getId(); if(b){s+=color.NEUTRAL;unseeableChar+=color.NEUTRAL.length();}</span>
<span class="fc bfc" id="L96" title="All 2 branches covered.">    }else if(o instanceof Graine){</span>
<span class="fc bfc" id="L97" title="All 4 branches covered.">      if(b){s+=color.BROWN;unseeableChar+=color.BROWN.length();} s+=&quot;G&quot;; s+=o.getId(); if(b){s+=color.NEUTRAL;unseeableChar+=color.NEUTRAL.length();}</span>
<span class="fc bfc" id="L98" title="All 2 branches covered.">    }else if(o instanceof Fourmi){</span>
<span class="fc bfc" id="L99" title="All 2 branches covered.">      if(b){s+=getColorAllyStatus((Creature)o);}</span>
<span class="fc" id="L100">      s+=o.getId();</span>
<span class="fc bfc" id="L101" title="All 2 branches covered.">      if(b){s+=color.NEUTRAL;unseeableChar+=color.NEUTRAL.length();}</span>
    }else{
<span class="fc bfc" id="L103" title="All 4 branches covered.">      if(b){s+=color.BLACK;unseeableChar+=color.BLACK.length();} s+=&quot;C&quot;; s+=o.getId(); if(b){s+=color.NEUTRAL;unseeableChar+=color.NEUTRAL.length();}</span>
    }
<span class="fc" id="L105">    return s;</span>
  }
  /**
  *{@summary Return the legend as a String.}&lt;br&gt;
  *Legend can be empty or can have line that look like this &quot;A : F1, 5, G12 \n B : 8, 3 etc.&quot;&lt;br&gt;
  *@version 1.38
  */
  private String legendToString(){
<span class="nc" id="L113">    String sr=&quot;&quot;;</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">    if (legend!=null){</span>
<span class="nc" id="L115">      sr+=g.get(&quot;légende&quot;)+&quot; :\n&quot;;</span>
<span class="nc" id="L116">      sr+=legend.toString();</span>
    }
<span class="nc" id="L118">    return sr;</span>
  }
  /**
  *{@summary Return the map as a String easy to use.}&lt;br&gt;
  *@version 1.38
  */
  //public only for test
  public String mapToMapString(){
<span class="nc" id="L126">    CCase cc = gc.getDébut();</span>
<span class="nc" id="L127">    String sr = &quot;&quot;;</span>
<span class="nc" id="L128">    Joueur j = Main.getPlayingJoueur();</span>
<span class="nc" id="L129">    int xi2=0;</span>
<span class="nc" id="L130">    sr+=&quot; &quot;;</span>
<span class="nc bnc" id="L131" title="All 2 branches missed.">    if(Main.getOs().isLinux()){sr+=color.UNDERLINE;}</span>
<span class="nc bnc" id="L132" title="All 2 branches missed.">    if(Main.getOs().isLinux()){sr+=color.BLUE;}</span>
<span class="nc" id="L133">    sr+=&quot; &quot;;</span>
<span class="nc" id="L134">    int len = gc.getWidth();</span>
<span class="nc bnc" id="L135" title="All 2 branches missed.">    for (int i=0;i&lt;len ;i++ ) {</span>
<span class="nc" id="L136">      String sTemp = i+&quot; &quot;;</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">      while (sTemp.length()&lt;sizeCase) {</span>
<span class="nc" id="L138">        sTemp+=&quot; &quot;;</span>
      }
<span class="nc" id="L140">      sr+=sTemp;</span>
    }
<span class="nc bnc" id="L142" title="All 2 branches missed.">    if(Main.getOs().isLinux()){sr+=color.NEUTRAL;}</span>
<span class="nc" id="L143">    sr+=&quot;\n&quot;;</span>
<span class="nc bnc" id="L144" title="All 2 branches missed.">    while(cc!=null){</span>
<span class="nc" id="L145">      xi2++;</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">      if(Main.getOs().isLinux()){sr+=color.BLUE;}</span>
<span class="nc" id="L147">      sr+=ascii.getNuméroationEnAbcd(xi2)+&quot;|&quot;;</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">      if(Main.getOs().isLinux()){sr+=color.NEUTRAL;}</span>
<span class="nc" id="L149">      sr+=mapLineToString(cc,j)+&quot;\n&quot;;</span>
<span class="nc" id="L150">      cc=cc.getBas();</span>
    }
<span class="nc" id="L152">    return sr;</span>
  }
  /**
  *{@summary Return the map as a String.}&lt;br&gt;
  *All map infos are stored in a GCase, this.gc.
  *@version 1.38
  */
  //public only for test
  public String mapToString(){
<span class="fc" id="L161">    CCase cc = gc.getDébut();</span>
<span class="fc" id="L162">    String sr = &quot;&quot;;</span>
<span class="fc" id="L163">    Joueur j = Main.getPlayingJoueur();</span>
<span class="fc bfc" id="L164" title="All 2 branches covered.">    while(cc!=null){</span>
<span class="fc" id="L165">      sr+=mapLineToString(cc,j)+&quot;\n&quot;;</span>
<span class="fc" id="L166">      cc=cc.getBas();</span>
    }
<span class="fc" id="L168">    return sr;</span>
  }
  /**
  *{@summary Return a line of a map as a String.}&lt;br&gt;
  *@param cc The 1a CCase of the line.
  *@version 1.39
  */
  //public only for test
  public String mapLineToString(CCase cc, Joueur j){
<span class="fc" id="L177">    String sr = &quot;&quot;;</span>
<span class="fc bfc" id="L178" title="All 2 branches covered.">    while(cc!=null){</span>
<span class="pc bpc" id="L179" title="1 of 2 branches missed.">      if(j==null){sr+=caseToString(cc.getContenu(),false,false);}</span>
<span class="fc" id="L180">      sr+=caseToString(cc,j);</span>
<span class="fc" id="L181">      cc=cc.getDroite();</span>
    }
<span class="fc" id="L183">    return sr;</span>
  }
  /**
  *{@summary Return a case as a String.}&lt;br&gt;
  *This string have a fix length.&lt;br&gt;
  *@param cc CCase that contain Case to print.
  *@param j Player that will be used to know if cases need to be nuageuse or sombre.
  *@version 1.38
  */
  //public only for test
  public String caseToString(CCase cc, Joueur j){
<span class="fc" id="L194">    return caseToString(cc.getContenu(),j.isCaseNuageuse(cc),j.isCaseSombre(cc));</span>
  }
  /**
  *{@summary Return a Case as a String.}&lt;br&gt;
  *This string have a fix length.&lt;br&gt;
  *@param contenu Case to print.
  *@param caseNuageuse Boolean to know if player have explored the Case.
  *@param caseSombre Boolean to know if player is curently seeing the Case.
  *@version 1.38
  */
  //public only for test
  public String caseToString(Case contenu, boolean caseNuageuse, boolean caseSombre){
<span class="fc" id="L206">    int nbrDElementSurCase = contenu.getNbrDElementSurCase();</span>
<span class="fc" id="L207">    String sr = &quot;&quot;;</span>
<span class="fc" id="L208">    unseeableChar=0;</span>
    //if case need to be hide :
<span class="fc bfc" id="L210" title="All 4 branches covered.">    if(Main.getPartie().getCarte().getCasesNuageuses()==true &amp;&amp; caseNuageuse){</span>
<span class="fc bfc" id="L211" title="All 2 branches covered.">      while (sr.length()&lt;sizeCase+unseeableChar){sr = sr + &quot;■&quot;;}</span>
<span class="fc bfc" id="L212" title="All 4 branches covered.">    }else if(Main.getPartie().getCarte().getCasesSombres()==true &amp;&amp; caseSombre){</span>
<span class="fc bfc" id="L213" title="All 2 branches covered.">      if(contenu.getFere() != null){</span>
<span class="fc" id="L214">        sr = &quot;F&quot;+contenu.getFere().getId();</span>
      }
<span class="fc" id="L216">      sr+=caseColor(contenu);</span>
<span class="fc bfc" id="L217" title="All 2 branches covered.">      while (sr.length()&lt;sizeCase+unseeableChar){sr = sr + &quot;□&quot;;}</span>
    }else{
<span class="fc bfc" id="L219" title="All 2 branches covered.">      if (nbrDElementSurCase == 0){</span>
<span class="pc bpc" id="L220" title="1 of 2 branches missed.">        if(!Main.getOs().isLinux()){sr = &quot;-&quot;;}</span>
<span class="pc bpc" id="L221" title="1 of 2 branches missed.">      }else if(nbrDElementSurCase == 1){</span>
<span class="fc bfc" id="L222" title="All 2 branches covered.">        if(contenu.getFere() != null){</span>
<span class="fc" id="L223">          sr = &quot;F&quot;+contenu.getFere().getId();</span>
<span class="fc bfc" id="L224" title="All 2 branches covered.">        }else if (contenu.getGc().getDébut() != null){</span>
<span class="fc" id="L225">          sr = sr + objetSurCarteAIdToString(contenu.getGc().getDébut().getContenu());</span>
        }else{
<span class="fc" id="L227">          sr = sr + objetSurCarteAIdToString(contenu.getGg().getDébut().getContenu());</span>
        }
      }else{
<span class="nc" id="L230">        xi++;</span>
<span class="nc" id="L231">        sr = ascii.getNuméroationEnAbcd(xi);</span>
        // ajout dans la legend.
<span class="nc" id="L233">        String s = sr +&quot; : &quot;;</span>
<span class="nc bnc" id="L234" title="All 2 branches missed.">        if(contenu.getFere() != null){</span>
<span class="nc" id="L235">          s = s + &quot;F&quot;+contenu.getFere().getId()+&quot;, &quot;;</span>
        }
<span class="nc bnc" id="L237" title="All 2 branches missed.">        for (Creature c : contenu.getGc().toList()) {</span>
<span class="nc" id="L238">          s+=objetSurCarteAIdToString(c)+&quot;, &quot;;</span>
<span class="nc" id="L239">        }</span>
<span class="nc bnc" id="L240" title="All 2 branches missed.">        for (Graine g : contenu.getGg().toList()) {</span>
<span class="nc" id="L241">          s+=objetSurCarteAIdToString(g)+&quot;, &quot;;</span>
<span class="nc" id="L242">        }</span>
<span class="nc" id="L243">        s = s.substring(0,s.length()-2);</span>
<span class="nc" id="L244">        legend.add(s);</span>
<span class="nc" id="L245">        unseeableChar=0;</span>
      }
    }
<span class="fc" id="L248">    sr+=caseColor(contenu);</span>
<span class="fc bfc" id="L249" title="All 2 branches covered.">    while (sr.length()&lt;sizeCase+unseeableChar){sr = sr + &quot; &quot;;}</span>
<span class="pc bpc" id="L250" title="1 of 2 branches missed.">    if(Main.getOs().isLinux()){sr+=color.NEUTRAL;unseeableChar+=color.NEUTRAL.length();}</span>
<span class="fc" id="L251">    return sr;</span>
  }
  /**
  *{@summary Return the backgroud color of a Case.}&lt;br&gt;
  *@param c Case to print.
  *@version 1.38
  */
  //public only for test
  public String caseColor(Case c){
<span class="pc bpc" id="L260" title="1 of 2 branches missed.">    if(!Main.getOs().isLinux()){return &quot;&quot;;}</span>
<span class="nc" id="L261">    String sr=&quot;&quot;;</span>
<span class="nc bnc" id="L262" title="All 5 branches missed.">    switch (c.getType()) {</span>
      case 0 :
<span class="nc" id="L264">      sr+=color.BLACK_BACKGROUND;unseeableChar+=color.BLACK_BACKGROUND.length();</span>
<span class="nc" id="L265">      break;</span>
      case 1 :
<span class="nc" id="L267">      sr+=color.GREEN_BACKGROUND;unseeableChar+=color.GREEN_BACKGROUND.length();</span>
<span class="nc" id="L268">      break;</span>
      case 2 :
<span class="nc" id="L270">      sr+=color.PURPLE_BACKGROUND;unseeableChar+=color.PURPLE_BACKGROUND.length();</span>
<span class="nc" id="L271">      break;</span>
      case 3 :
<span class="nc" id="L273">      sr+=color.YELLOW_BACKGROUND;unseeableChar+=color.YELLOW_BACKGROUND.length();</span>
      break;
      //default :
      //break;
    }
<span class="nc" id="L278">    return sr;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>